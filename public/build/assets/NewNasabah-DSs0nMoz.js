import{X as ie,r,G as oe,d as b,j as e,e as I}from"./app-hJcCqjW3.js";import{I as u}from"./InputError-CxOHbcDS.js";import{L as de}from"./Loading-D350lQTx.js";import{B as j}from"./button-w0rV5GV_.js";import"./card-BnWaktMe.js";import{T as me,a as ce,b as k,c as _}from"./tabs-BrHYW8HQ.js";import{I as c}from"./input-DTZJRZ5a.js";import{L as i}from"./label-2lPo-klO.js";import{C as T}from"./index.esm-BxWG_Hjc.js";import{u as ue,S as xe}from"./SelectComponent-DPbOliiM.js";import C from"./RiwayatPengajuan-BUpTMSc2.js";import{C as pe}from"./Checkbox-DjMvCQfB.js";import{F as he}from"./FormatNumbering-C9tmG4Pu.js";import{u as ge}from"./useFrontEndPermission-CTM1adQD.js";import{N as fe}from"./NoEditOverlay-2s8IYogi.js";import"./table-D_beEVt0.js";import{S as je}from"./search-aHqfTxot.js";import{X as be}from"./x-B8dVLonu.js";import"./index-FY3p6vDS.js";import"./transition-B3HvLuM7.js";import"./index-rcIM_YSj.js";import"./utils-CytzSlOG.js";import"./index-6W4JOOiF.js";import"./index-Ctldr2EF.js";import"./index-DIWZVBTi.js";import"./index-YKYYjyh_.js";import"./index-CBlXBiuZ.js";import"./index-OIJ2qtHJ.js";import"./BadgeStatus-CCgDMpxB.js";import"./badge-DjX-fht6.js";import"./react-number-format.es-GMR1PP2I.js";import"./createLucideIcon-j_UEUJVl.js";const ea=({onClosed:M,generateAngsuran:Y=!1,submitUrl:K,typeInput:P="number"})=>{const{printUrl:y}=ie().props,{isUnit:ve,isMantri:Ne,isCanShowKelompok:L,isCreator:R}=ge(),[q,V]=r.useState(null);r.useEffect(()=>{V(y.url)},[y.timestamp]);const{optKelompok:F}=ue(),{data:s,setData:h,post:U,errors:x,processing:G,reset:S}=oe({isActiveMember:!1,nik:"",request_date:"",tanggal_drop:"",no_kk:"",nama:"",alamat:"",kelompok:"",request_nominal:0,angsuran:[]}),[o,f]=r.useState([]),[O,B]=r.useState(0);r.useEffect(()=>{const a=parseInt(s.request_nominal??0)*1.3,n=s.angsuran.reduce((t,l)=>{const m=parseInt(l.nominal,10);return t+(isNaN(m)?0:m)},0);B(a-n)},[s.angsuran,s.request_nominal]),r.useEffect(()=>{f([])},[s.tanggal_drop]),r.useEffect(()=>{h("angsuran",o)},[o]);const H=()=>{const a=o.length>0?b(o[o.length-1].transaction_date).add(1,"week").format("YYYY-MM-DD"):s.tanggal_drop?b(s.tanggal_drop).add(1,"week").format("YYYY-MM-DD"):"";f([...o,{id:Date.now(),transaction_date:a}])},$=a=>{f(o.filter(n=>n.id!==a))},D=(a,n,t)=>{f(o.map(l=>l.id===a?{...l,[n]:t}:l))},z=(a,n,t)=>{f(o.map(l=>l.id===t?{...l,[n]:a}:l))},[g,X]=r.useState(""),[J,v]=r.useState(!1),[A,E]=r.useState(),[d,N]=r.useState([]),[Q,W]=r.useState();r.useEffect(()=>{W(s.request_date),h(a=>({...a,tanggal_drop:b(s.request_date).add(1,"week").format("YYYY-MM-DD")}))},[s.request_date]);const Z=(a,n,t)=>{h(n,a)},p=a=>{const{name:n,value:t}=a.target;h(n,t)},ee=a=>{const{name:n,value:t}=a.target;N([]),X(t)},w=r.useRef(null),ae=async a=>{var t,l;a.preventDefault(),w.current&&w.current.abort();const n=new AbortController;w.current=n,S(),v(!0),E();try{const{data:m}=await I.post(route("transaction.nasabah_buku_transaksi"),{nik:g},{signal:n.signal});v(!1),h(re=>({...re,nik:m.return_nik,isActiveMember:!!m.data})),m.data?(console.log(m.data),N(m.data)):N([])}catch(m){I.isCancel(m)?console.log("Request dibatalkan karena ada fetch baru."):(E(((l=(t=m.response)==null?void 0:t.data)==null?void 0:l.message)||"Terjadi kesalahan."),v(!1))}},se=a=>{M(),S()},te=a=>{a.preventDefault(),U(K,{onSuccess:()=>{se()},replace:!0})},ne=[{value:3e5,label:"300rb"},{value:4e5,label:"400rb"},{value:5e5,label:"500rb"},{value:7e5,label:"700rb"},{value:8e5,label:"800rb"},{value:1e6,label:"1 jt"},{value:13e5,label:"1,3 jt"},{value:15e5,label:"1,5 jt"},{value:2e6,label:"2 jt"}],le=a=>{const n=a.target.getAttribute("data-value");h("request_nominal",n)};return e.jsxs("div",{className:"flex flex-col w-full gap-3 lg:flex-row",children:[e.jsx(de,{show:J||G}),e.jsxs("div",{className:"w-auto",children:[e.jsxs("fieldset",{className:"min-w-[20vw] p-4 mb-3 border rounded-lg",children:[e.jsx("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"CEK NIK NASABAH"}),e.jsxs("form",{className:"w-full mb-3",onSubmit:ae,children:[e.jsx(i,{optional:!0,children:"NIK"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{type:P,name:"nik",value:g,onChange:ee,placeholder:"Cek NIK"}),e.jsxs(j,{className:"text-xs",size:"sm",children:[e.jsx(je,{className:"w-auto h-4 mr-1"}),"Cari"]})]}),A&&e.jsx(u,{message:A,className:"mt-1"}),e.jsxs("div",{className:`font-semibold mt-1 ${g.length==16?"text-green-500":"text-red-500"}`,children:[g.length," Digit"]}),e.jsx("div",{children:q&&e.jsx("a",{href:q??"#",target:"_blank",children:"Lihat Transaksi Terakhir"})})]})]}),e.jsx("div",{className:"relative",children:g&&s.nik==g&&e.jsxs("fieldset",{className:"w-full p-4 border rounded-lg",children:[!R&&e.jsx(fe,{value:"User Tidak Dapat Digunakan Untuk Menambah Pinjaman"}),e.jsx("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"Detail Pinjaman"}),e.jsxs("form",{className:"w-full mb-3",onSubmit:te,children:[e.jsxs("div",{className:"flex flex-col gap-5 lg:flex-row",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Tanggal Pengajuan"}),e.jsx(c,{type:"date",name:"request_date",required:!0,value:s.request_date,onChange:p}),e.jsx(u,{message:x.request_date})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Tanggal Drop"}),e.jsx(c,{type:"date",name:"tanggal_drop",min:Q,required:!0,value:s.tanggal_drop,onChange:p}),e.jsx(u,{message:x.tanggal_drop})]})]}),s.request_date&&s.request_date==s.tanggal_drop?e.jsx("div",{className:"w-full mb-3 font-semibold text-red-500",children:"DROP BARU"}):e.jsx("div",{className:"w-full mb-3 font-semibold text-red-500",children:"PENGAJUAN DROP"}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{optional:!0,children:"NIK"}),e.jsx(c,{type:"text",name:"nik",value:s.nik,disabled:!0,onChange:p}),e.jsx(u,{message:x.nik})]}),s.isActiveMember?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Nama"}),e.jsx(c,{type:"text",disabled:!0,value:d.nama??""})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Alamat"}),e.jsx(c,{type:"text",disabled:!0,value:d.alamat??""})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{optional:!0,children:"NO KK"}),e.jsx(c,{type:"text",name:"no_kk",value:s.no_kk,onChange:p}),e.jsx(u,{message:x.no_kk})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Nama"}),e.jsx(c,{type:"text",name:"nama",value:s.nama,onChange:p,required:!0}),e.jsx(u,{message:x.nama})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Alamat"}),e.jsx(c,{type:"text",name:"alamat",value:s.alamat,onChange:p,required:!0}),e.jsx(u,{message:x.alamat})]})]}),L&&e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Kelompok"}),e.jsx(xe,{value:s.kelompok,options:F,name:"kelompok",nullvalue:!0,onChange:p}),e.jsx(u,{message:x.kelompok})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Nominal Pinjaman"}),e.jsx(T,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:Z,value:s.request_nominal,placeholder:"Inputkan angka tanpa sparator"}),e.jsx(u,{message:x.request_nominal})]}),e.jsx("div",{className:"grid grid-cols-4 mb-3 gap-x-2 gap-y-1",children:ne.map((a,n)=>e.jsx(j,{type:"button",size:"xs","data-value":a.value,onClick:le,children:a.label},n))})]}),o.length>0&&e.jsxs("div",{className:"flex-1",children:[o.map((a,n)=>e.jsxs("div",{className:"flex flex-col gap-3 mb-3 lg:flex-row",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(i,{children:"Tanggal Storting"}),e.jsx(c,{type:"date",name:"transaction_date",min:b(s.tanggal_drop).add(1,"week").format("YYYY-MM-DD"),required:!0,value:a.transaction_date,onChange:t=>D(a.id,t.target.name,t.target.value)})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(i,{children:"Nominal"}),e.jsxs("div",{className:"flex items-center justify-start gap-3",children:[e.jsx("div",{className:"flex-1 min-w-32",children:e.jsx(T,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:(t,l)=>z(parseInt(t),l,a.id),value:a.nominal,placeholder:"Inputkan angka tanpa sparator"})}),e.jsxs("div",{className:"flex items-center justify-start gap-1",children:[e.jsx(pe,{name:"dana_titipan",id:`dana_titipan_${a.id}`,checked:a.isActiveMember,onChange:t=>D(a.id,t.target.name,t.target.checked)}),e.jsx(i,{htmlFor:`dana_titipan_${a.id}`,className:"whitespace-nowrap",nomb:!0,children:"Dana Titipan"})]}),e.jsx(j,{onClick:()=>$(a.id),type:"button",size:"iconsm",variant:"outline",children:e.jsx(be,{className:"w-auto h-3"})})]})]})]},a.id)),e.jsxs("div",{className:"flex justify-end gap-3 font-semibold text-red-500",children:[e.jsx("div",{children:"Saldo Tersisa"}),e.jsx(he,{value:O})]})]})]}),e.jsxs("div",{className:"text-end",children:[Y&&s.tanggal_drop&&e.jsx(j,{type:"button",onClick:H,className:"mr-3",variant:"outline",children:"Add Angsuran"}),e.jsx(j,{children:"Submit"})]})]})]})})]}),e.jsxs("div",{className:"w-auto lg:w-full",children:[e.jsx("div",{className:"text-xl mb-3 font-semibold",children:"CRASH"}),e.jsxs(me,{defaultValue:"pengajuan",className:"w-auto",children:[e.jsxs(ce,{className:"grid w-full grid-cols-3",children:[e.jsx(k,{value:"pengajuan",children:"Kantor"}),e.jsx(k,{value:"pinjaman",children:"Kantor Lain (ML)"}),e.jsx(k,{value:"pinjaman2",children:"Kantor Lain (T)"})]}),e.jsx(_,{value:"pengajuan",children:e.jsx("div",{className:"overflow-auto shadow-sm scrollbar-thin h-max",children:e.jsx(C,{data:d==null?void 0:d.history_branch})})}),e.jsx(_,{value:"pinjaman",children:e.jsx("div",{className:"overflow-auto shadow-sm scrollbar-thin h-max",children:e.jsx(C,{data:d==null?void 0:d.history_macet_lain})})}),e.jsx(_,{value:"pinjaman2",children:e.jsx("div",{className:"overflow-auto shadow-sm scrollbar-thin h-max",children:e.jsx(C,{data:d==null?void 0:d.history_target})})})]})]})]})};export{ea as default};

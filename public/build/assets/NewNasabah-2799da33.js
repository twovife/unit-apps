import{q as le,r as s,W as ie,c as x,j as a,a as e,F as A,k as re}from"./app-1513e6ad.js";import{I as u}from"./InputError-ff1ce2b5.js";import{L as se}from"./Loading-dd9671cb.js";import{B as m}from"./button-fa3185df.js";import"./card-496f5bec.js";import{T as oe,a as de,b as E,c as I}from"./tabs-952dd9b9.js";import{I as c}from"./input-79bff17c.js";import{L as r}from"./label-fcb642ac.js";import{C as M}from"./index.esm-a025e82b.js";import{u as me,S as ce}from"./SelectComponent-5b175194.js";import Y from"./RiwayatPengajuan-417d5035.js";import{C as ue}from"./Checkbox-da7e107c.js";import{F as pe}from"./FormatNumbering-8f8bff39.js";import{u as he}from"./useFrontEndPermission-e97f7be2.js";import{N as ge}from"./NoEditOverlay-92680984.js";import{S as fe}from"./search-cd240278.js";import{X as ve}from"./x-9cf345df.js";import"./transition-d80bb77d.js";import"./utils-aa679991.js";import"./index-1c376abe.js";import"./index-fbaf698f.js";import"./index-40c8da9e.js";import"./index-3fba9fed.js";import"./index-f6c8e49c.js";import"./table-7e5d8dfc.js";import"./index-2e4ba388.js";import"./BargeStatus-c0c91ea9.js";import"./ModalShowAngsuran-2efd8777.js";import"./dialog-c0b29a8d.js";import"./react-icons.esm-5687bae1.js";import"./react-number-format.es-55b240a9.js";import"./createLucideIcon-0dc67ecd.js";const Qe=({onClosed:T,generateAngsuran:P=!1,submitUrl:K})=>{const{printUrl:_}=le().props,{isUnit:be,isMantri:Ne,isCanShowKelompok:z,isCreator:L}=he(),[C,U]=s.useState(null);s.useEffect(()=>{U(_.url)},[_.timestamp]);const{optKelompok:F}=me(),{data:n,setData:v,post:R,errors:p,processing:V,reset:y}=ie({isActiveMember:!1,nik:"",request_date:"",tanggal_drop:"",no_kk:"",nama:"",alamat:"",kelompok:"",request_nominal:0,angsuran:[]});console.log(n);const[o,N]=s.useState([]),[B,O]=s.useState(0);s.useEffect(()=>{const t=parseInt(n.request_nominal??0)*1.3,l=n.angsuran.reduce((i,d)=>{const j=parseInt(d.nominal,10);return i+(isNaN(j)?0:j)},0);O(t-l)},[n.angsuran,n.request_nominal]),s.useEffect(()=>{N([])},[n.tanggal_drop]),s.useEffect(()=>{v("angsuran",o)},[o]);const G=()=>{const t=o.length>0?x(o[o.length-1].transaction_date).add(1,"week").format("YYYY-MM-DD"):n.tanggal_drop?x(n.tanggal_drop).add(1,"week").format("YYYY-MM-DD"):"";N([...o,{id:Date.now(),transaction_date:t}])},H=t=>{N(o.filter(l=>l.id!==t))},q=(t,l,i)=>{N(o.map(d=>d.id===t?{...d,[l]:i}:d))},J=(t,l,i)=>{N(o.map(d=>d.id===i?{...d,[l]:t}:d))},[b,$]=s.useState(""),[W,k]=s.useState(!1),[D,S]=s.useState(),[h,w]=s.useState([]),[X,Q]=s.useState();s.useEffect(()=>{Q(n.request_date),v(t=>({...t,tanggal_drop:x(n.request_date).add(1,"week").format("YYYY-MM-DD")}))},[n.request_date]);const Z=(t,l,i)=>{v(l,t)},g=t=>{const{name:l,value:i}=t.target;v(l,i)},ee=t=>{const{name:l,value:i}=t.target;w([]),$(i)},ae=async t=>{t.preventDefault(),y(),k(!0),S(),await re({method:"post",url:route("transaction.nasabah_buku_transaksi"),data:{nik:b}}).then(function({data:l}){k(!1),v(i=>({...i,nik:l.return_nik,isActiveMember:!!l.data})),l.data?w(l.data):w([])}).catch(function({response:l}){S(l.data.message),k(!1)})},te=t=>{T(),y()},ne=t=>{t.preventDefault(),R(K,{onSuccess:()=>{te()},replace:!0})},f=t=>{const l=t.target.getAttribute("data-value");v("request_nominal",l)};return a("div",{className:"flex flex-col w-full gap-3 lg:flex-row",children:[e(se,{show:W||V}),a("div",{className:"w-auto",children:[a("fieldset",{className:"min-w-[20vw] p-3 mb-3 border rounded-lg",children:[e("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"CEK NIK NASABAH"}),a("form",{className:"w-full",onSubmit:ae,children:[e(r,{children:"NIK"}),a("div",{className:"grid grid-cols-3 grid-rows-2 gap-2",children:[a("div",{className:"col-span-3",children:[e(c,{type:"text",name:"nik",value:b,onChange:ee,placeholder:"Cek NIK"}),D&&e("div",{children:e(u,{message:D,className:"mt-1"})})]}),a("div",{className:`font-semibold mt-1 col-span-2 ${b.length==16?"text-green-500":"text-red-500"}`,children:[b.length," Digit"]}),e("div",{className:"col-span-1 text-end",children:a(m,{className:"text-xs",size:"sm",children:[e(fe,{className:"w-auto h-4 mr-1"}),"Cari"]})})]}),e("div",{children:C&&e("a",{href:C??"#",target:"_blank",children:"Lihat Transaksi Terakhir"})})]})]}),e("div",{className:"relative",children:b&&n.nik==b&&a("fieldset",{className:"w-full p-4 border rounded-lg",children:[!L&&e(ge,{value:"User Tidak Dapat Digunakan Untuk Menambah Pinjaman"}),e("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"Detail Pengajuan"}),a("form",{className:"w-full mb-3",onSubmit:ne,children:[a("div",{className:"flex flex-col gap-5 lg:flex-row",children:[a("div",{className:"flex-1",children:[a("div",{className:"gap-3 lg:flex",children:[a("div",{className:"w-full mb-3",children:[e(r,{children:"Tanggal Pengajuan"}),e(c,{type:"date",name:"request_date",required:!0,value:n.request_date,onChange:g}),e(u,{message:p.request_date})]}),a("div",{className:"w-full mb-3",children:[e(r,{children:"Tanggal Drop"}),e(c,{type:"date",name:"tanggal_drop",min:X,required:!0,value:n.tanggal_drop,onChange:g}),e(u,{message:p.tanggal_drop})]})]}),n.request_date&&n.request_date==n.tanggal_drop?e("div",{className:"w-full mb-3 font-semibold text-red-500",children:"DROP BARU"}):e("div",{className:"w-full mb-3 font-semibold text-red-500",children:"PENGAJUAN DROP"}),a("div",{className:"w-full mb-3",children:[e(r,{optional:!0,children:"NIK"}),e(c,{type:"text",name:"nik",value:n.nik,disabled:!0,onChange:g}),e(u,{message:p.nik})]}),n.isActiveMember?a(A,{children:[a("div",{className:"w-full mb-3",children:[e(r,{children:"Nama"}),e(c,{type:"text",disabled:!0,value:h.nama??""})]}),a("div",{className:"w-full mb-3",children:[e(r,{children:"Alamat"}),e(c,{type:"text",disabled:!0,value:h.alamat??""})]})]}):a(A,{children:[a("div",{className:"w-full mb-3",children:[e(r,{optional:!0,children:"NO KK"}),e(c,{type:"text",name:"no_kk",value:n.no_kk,onChange:g}),e(u,{message:p.no_kk})]}),a("div",{className:"w-full mb-3",children:[e(r,{children:"Nama"}),e(c,{type:"text",name:"nama",value:n.nama,onChange:g,required:!0}),e(u,{message:p.nama})]}),a("div",{className:"w-full mb-3",children:[e(r,{children:"Alamat"}),e(c,{type:"text",name:"alamat",value:n.alamat,onChange:g,required:!0}),e(u,{message:p.alamat})]})]}),z&&a("div",{className:"w-full mb-3",children:[e(r,{children:"Kelompok"}),e(ce,{value:n.kelompok,options:F,name:"kelompok",nullvalue:!0,onChange:g}),e(u,{message:p.kelompok})]}),a("div",{className:"w-full mb-3",children:[e(r,{children:"Nominal Pinjaman"}),e(M,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:Z,value:n.request_nominal,placeholder:"Inputkan angka tanpa sparator"}),e(u,{message:p.request_nominal})]}),a("div",{className:"flex flex-wrap w-full gap-2 mb-3",children:[e(m,{type:"button",variant:"outline",size:"xs",onClick:f,"data-value":"400000",children:"400rb"}),e(m,{type:"button",variant:"outline",size:"xs",onClick:f,"data-value":"500000",children:"500rb"}),e(m,{type:"button",variant:"outline",size:"xs",onClick:f,"data-value":"700000",children:"700rb"}),e(m,{type:"button",variant:"outline",size:"xs",onClick:f,"data-value":"800000",children:"800rb"}),e(m,{type:"button",variant:"outline",size:"xs",onClick:f,"data-value":"1000000",children:"1 Jt"}),e(m,{type:"button",variant:"outline",size:"xs",onClick:f,"data-value":"1500000",children:"1,5 Jt"}),e(m,{type:"button",variant:"destructive",size:"xs",onClick:f,"data-value":"0",children:"reset"})]})]}),o.length>0&&a("div",{className:"flex-1",children:[o.map((t,l)=>a("div",{className:"flex flex-col gap-3 mb-3 lg:flex-row",children:[a("div",{className:"w-full",children:[e(r,{children:"Tanggal Storting"}),e(c,{type:"date",name:"transaction_date",min:x(n.tanggal_drop).add(1,"week").format("YYYY-MM-DD"),required:!0,value:t.transaction_date,onChange:i=>q(t.id,i.target.name,i.target.value)})]}),a("div",{className:"w-full",children:[e(r,{children:"Nominal"}),a("div",{className:"flex items-center justify-start gap-3",children:[e("div",{className:"flex-1 min-w-32",children:e(M,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:(i,d)=>J(parseInt(i),d,t.id),value:t.nominal,placeholder:"Inputkan angka tanpa sparator"})}),a("div",{className:"flex items-center justify-start gap-1",children:[e(ue,{name:"dana_titipan",id:`dana_titipan_${t.id}`,checked:t.isActiveMember,onChange:i=>q(t.id,i.target.name,i.target.checked)}),e(r,{htmlFor:`dana_titipan_${t.id}`,className:"whitespace-nowrap",nomb:!0,children:"Dana Titipan"})]}),e(m,{onClick:()=>H(t.id),type:"button",size:"iconsm",variant:"outline",children:e(ve,{className:"w-auto h-3"})})]})]})]},t.id)),a("div",{className:"flex justify-end gap-3 font-semibold text-red-500",children:[e("div",{children:"Saldo Tersisa"}),e(pe,{value:B})]})]})]}),a("div",{className:"text-end",children:[P&&n.tanggal_drop&&e(m,{type:"button",onClick:G,className:"mr-3",variant:"outline",children:"Add Angsuran"}),e(m,{children:"Submit"})]})]})]})})]}),e("div",{className:"w-auto lg:w-full",children:a(oe,{defaultValue:"pengajuan",className:"w-auto",children:[a(de,{className:"grid w-full grid-cols-2",children:[e(E,{value:"pengajuan",children:"Crash Kantor"}),e(E,{value:"pinjaman",children:"Crash UBM"})]}),e(I,{value:"pengajuan",children:e("div",{className:"max-h-[70vh] h-min overflow-auto scrollbar-thin rounded",children:e(Y,{data:h==null?void 0:h.history_branch})})}),e(I,{value:"pinjaman",children:e("div",{className:"max-h-[70vh] h-min overflow-auto scrollbar-thin rounded",children:e(Y,{data:h==null?void 0:h.history_lain})})})]})})]})};export{Qe as default};

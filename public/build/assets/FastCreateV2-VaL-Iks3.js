import{r,j as e,d as m,X as xe,G as fe,e as he}from"./app-Dxvm8qLT.js";import{A as ge}from"./AuthenticatedLayout-BqQAR2Ch.js";import{I as c}from"./input-CGELXTQE.js";import{I as R}from"./InputLabel-v5izegO9.js";import{B as q}from"./button-DSAeS3Ja.js";import{L as je}from"./Loading-BOQv6bKm.js";import{I as f}from"./InputError-CXJsr0lZ.js";import{u as be}from"./useFrontEndPermission-CvlsrWGS.js";import{L as i}from"./label-Cnd3mOF8.js";import{T as ve,a as Ne,b as F,c as z}from"./tabs-BCoBU2cE.js";import{C as y}from"./index.esm-BSRJjjab.js";import{u as ke,S as we}from"./SelectComponent-DjJlQ71u.js";import{C as _e}from"./Checkbox-Bzp42OOn.js";import{P as ye}from"./index-R_VWclwN.js";import{c as Ce}from"./utils-CytzSlOG.js";import $ from"./RiwayatPengajuan-B9re0o9D.js";import{L as Se}from"./LinkButton-Dtj5Y7wR.js";import{S as Me}from"./search-BD3bcpC3.js";import"./Dropdown-CC3HHzCl.js";import"./createLucideIcon-CP7Voj94.js";import"./sweetalert2.esm.all-D2lqrH_P.js";import"./index-BbqZbC8l.js";import"./index-n_on67jh.js";import"./index-DU6o6IdQ.js";import"./Combination-o7meGx_X.js";import"./index-KmVfJpTJ.js";import"./index-pul9gyM1.js";import"./index-C2Dd9-6k.js";import"./react-icons.esm-C76GxFQe.js";import"./SweetAlert-Corszmx-.js";import"./transition-a5c1J63A.js";import"./index-Dk0U3FDJ.js";import"./table-CoH7fn_W.js";import"./index-DH37ehQJ.js";import"./BadgeStatus-zyY65Rs2.js";import"./badge-ronFUY1y.js";var Ye="Separator",B="horizontal",De=["horizontal","vertical"],G=r.forwardRef((h,j)=>{const{decorative:u,orientation:b=B,...d}=h,w=Ie(b)?b:B,E=u?{role:"none"}:{"aria-orientation":w==="vertical"?w:void 0,role:"separator"};return e.jsx(ye.div,{"data-orientation":w,...E,...d,ref:j})});G.displayName=Ye;function Ie(h){return De.includes(h)}var U=G;const T=r.forwardRef(({className:h,orientation:j="horizontal",decorative:u=!0,...b},d)=>e.jsx(U,{ref:d,decorative:u,orientation:j,className:Ce("shrink-0 bg-border",j==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",h),...b}));T.displayName=U.displayName;const ha=()=>{const h=localStorage.getItem("currentMonth")||m().format("YYYY-MM"),j=localStorage.getItem("currentKelompok")||1,[u,b]=r.useState(h),[d,w]=r.useState(j);r.useEffect(()=>{localStorage.setItem("currentMonth",u),localStorage.setItem("currentKelompok",d)},[u,d]);const{printUrl:C}=xe().props,{isUnit:E,isMantri:Ae,isCanShowKelompok:H,isCreator:qe}=be(),[K,X]=r.useState(null);r.useEffect(()=>{X(C.url)},[C.timestamp]);const{optKelompok:J}=ke(),{data:n,setData:p,post:Q,errors:g,reset:S}=fe({isActiveMember:!1,nik:"",tanggal_drop:"",no_kk:"",nama:"",alamat:"",kelompok:d||"",request_nominal:0,angsuran:[]}),[M,W]=r.useState(0);r.useEffect(()=>{const a=parseInt(n.request_nominal??0)*1.3,s=n.angsuran.reduce((t,l)=>{const o=parseInt(l.nominal,10);return t+(isNaN(o)?0:o)},0);W(a-s)},[n.angsuran,n.request_nominal]);const[_,Z]=r.useState(""),[ee,Y]=r.useState(!1),[V,L]=r.useState(),[x,D]=r.useState([]),[v,N]=r.useState([]),[O,I]=r.useState(!1),ae=a=>{const s=m(a),t=s.add(1,"week").format("YYYY-MM-DD"),l=m().format("YYYY-MM-DD");let o=m(u);const P=t<o.startOf("month").format("YYYY-MM-DD");I(P);let A=new Set;for(P&&A.add({id:1,transaction_date:t,nominal:0});o.isBefore(l);){const pe=o.format("YYYY-MM-DD");o.day()===s.day()&&o.isAfter(s)&&A.add({id:o.unix(),transaction_date:pe,nominal:0}),o=o.add(1,"day")}let ue=[...A];N(ue)},se=(a,s,t)=>{p(s,a)},k=a=>{const{name:s,value:t}=a.target;p(s,t),s=="kelompok"&&w(t),s=="tanggal_drop"&&ae(t)};r.useEffect(()=>{p("angsuran",v)},[v]);const te=a=>{const{name:s,value:t}=a.target;D([]),S(),p("kelompok",d),N([]),I(!1),Z(t)},ne=(a,s,t)=>{N(v.map(l=>l.id===a?{...l,[s]:t}:l))},le=(a,s,t)=>{N(v.map(l=>l.id===t?{...l,[s]:a}:l))},re=async a=>{a.preventDefault(),S(),p("kelompok",d),N([]),I(!1),Y(!0),L(),await he({method:"post",url:route("transaction.nasabah_buku_transaksi"),data:{nik:_}}).then(function({data:s}){Y(!1),p(t=>({...t,nik:s.return_nik,isActiveMember:!!s.data})),s.data?D(s.data):D([])}).catch(function({response:s}){L(s.data.message),Y(!1)})},ie=[{value:4e5,label:"400rb"},{value:5e5,label:"500rb"},{value:7e5,label:"700rb"},{value:8e5,label:"800rb"},{value:1e6,label:"1 jt"},{value:13e5,label:"1,3 jt"},{value:15e5,label:"1,5 jt"},{value:2e6,label:"2 jt"}],oe=a=>{const s=a.target.getAttribute("data-value");p("request_nominal",s)},de=a=>{const s=(n==null?void 0:n.request_nominal)*1.3-a;N(t=>t.some(l=>l.id===1)?t.map(l=>l.id===1?{...l,nominal:s}:l):[{id:1,transaction_date:m(n.tanggal_drop).add(1,"week").format("YYYY-MM-DD")},...t])},me=a=>{S(),p("kelompok",d)},ce=a=>{a.preventDefault(),Q(route("transaction.store_buku_transaksi_batch"),{onSuccess:()=>{me()},replace:!0})};return e.jsxs(ge,{children:[e.jsx("div",{className:"absolute z-20 right-2 bottom-2",children:e.jsx(Se,{color:"outline",href:route("transaction.fastcreate"),variant:"ghost",children:"V1"})}),e.jsx(je,{show:ee}),e.jsxs("div",{className:"w-full gap-3 lg:flex",children:[e.jsxs("div",{className:`w-auto min-w-[20vw] ${n.request_nominal>0?"lg:w-1/2":"lg:w-auto"}`,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(R,{value:"Tanggal Awal",className:"mb-1"}),e.jsx(c,{type:"month",value:u,max:m().format("YYYY-MM"),onChange:a=>b(a.target.value)})]}),e.jsxs("form",{className:"mb-1",onSubmit:re,children:[e.jsx(R,{value:"NIK",className:"mb-1"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(c,{type:"text",onChange:te}),e.jsx(q,{variant:"destructiveoutline",children:e.jsx(Me,{className:"w-4 h-4"})})]})]}),V&&e.jsx(f,{message:V,className:"mt-1"}),e.jsxs("div",{className:`font-semibold mb-3 ${_.length==16?"text-green-500":"text-red-500"}`,children:[_.length," Digit"]}),e.jsxs("form",{className:"relative",onSubmit:ce,children:[e.jsxs("div",{className:"flex flex-col w-full gap-3 lg:flex-row",children:[_&&n.nik==_&&e.jsxs("fieldset",{className:"flex-1 p-4 border rounded-lg",children:[e.jsx("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"Detail Pinjaman"}),e.jsx("div",{className:"w-full mb-3",children:e.jsx("div",{className:"flex flex-col gap-5 lg:flex-row",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex gap-3",children:e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Tanggal Drop"}),e.jsx(c,{type:"date",name:"tanggal_drop",required:!0,value:n.tanggal_drop,onChange:k}),e.jsx(f,{message:g.tanggal_drop}),e.jsx("div",{className:"mt-1 font-semibold text-green-500",children:m(n.tanggal_drop).format("dddd")})]})}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{optional:!0,children:"NIK"}),e.jsx(c,{type:"text",name:"nik",value:n.nik,disabled:!0,onChange:k}),e.jsx(f,{message:g.nik})]}),n.isActiveMember?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Nama"}),e.jsx(c,{type:"text",disabled:!0,value:x.nama??""})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Alamat"}),e.jsx(c,{type:"text",disabled:!0,value:x.alamat??""})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{optional:!0,children:"NO KK"}),e.jsx(c,{type:"text",name:"no_kk",value:n.no_kk,onChange:k}),e.jsx(f,{message:g.no_kk})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Nama"}),e.jsx(c,{type:"text",name:"nama",value:n.nama,onChange:k,required:!0}),e.jsx(f,{message:g.nama})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Alamat"}),e.jsx(c,{type:"text",name:"alamat",value:n.alamat,onChange:k,required:!0}),e.jsx(f,{message:g.alamat})]})]}),H&&e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Kelompok"}),e.jsx(we,{value:n.kelompok,options:J,name:"kelompok",nullvalue:!0,onChange:k}),e.jsx(f,{message:g.kelompok})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(i,{children:"Nominal Pinjaman"}),e.jsx(y,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:se,value:n.request_nominal,placeholder:"Inputkan angka tanpa sparator"}),e.jsx(f,{message:g.request_nominal})]}),e.jsx("div",{className:"grid grid-cols-4 mb-3 gap-x-2 gap-y-1",children:ie.map((a,s)=>e.jsx(q,{type:"button",size:"xs","data-value":a.value,onClick:oe,children:a.label},s))})]})})})]}),n.request_nominal>0&&e.jsxs("fieldset",{className:"flex-1 p-4 border rounded-lg",children:[e.jsx("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"Detail Angsuran"}),m(n.tanggal_drop)&&O&&e.jsx("div",{children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(i,{children:["Saldo Akhir"," ",m(u).subtract(1,"month").format("MMMM")]}),e.jsx(y,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"nominal",defaultValue:n.request_nominal*1.3,allowDecimals:!1,prefix:"Rp. ",min:1,max:M,required:!0,onValueChange:(a,s)=>de(a),placeholder:"Inputkan angka tanpa sparator"})]})}),e.jsx(T,{className:"my-3"}),m(n.tanggal_drop)&&v.length>0&&v.map((a,s)=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-3 lg:flex-row ",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(i,{children:"Tanggal Storting"}),e.jsx(c,{type:"date",readOnly:!0,name:"transaction_date",required:!0,value:a.transaction_date})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(i,{children:"Nominal"}),e.jsxs("div",{className:"flex items-center justify-start gap-3",children:[e.jsx("div",{className:"flex-1 min-w-32",children:e.jsx(y,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,max:M,required:!0,readOnly:O&&s==0,onValueChange:(t,l)=>le(t,l,a.id),value:a.nominal,placeholder:"Inputkan angka tanpa sparator"})}),e.jsxs("div",{className:"flex items-center justify-start gap-1",children:[e.jsx(_e,{name:"dana_titipan",id:`dana_titipan_${a.id}`,checked:a.isActiveMember,onChange:t=>ne(a.id,t.target.name,t.target.checked)}),e.jsx(i,{htmlFor:`dana_titipan_${a.id}`,className:"whitespace-nowrap",nomb:!0,children:"Dana Titipan"})]})]})]})]},a.id),e.jsx(T,{className:"my-3 bg-red-500"})]})),e.jsxs("div",{className:"mb-3",children:[e.jsx(i,{className:"mb-1",children:"Sisa Saldo"}),e.jsx(y,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,value:M,disabled:!0,placeholder:"Inputkan angka tanpa sparator"})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:K&&e.jsx("a",{href:K??"#",target:"_blank",children:"Lihat Transaksi Terakhir"})}),e.jsx("div",{children:n.request_nominal>0&&e.jsx(q,{children:"Submit"})})]})]})]}),e.jsxs("div",{className:`w-auto  ${n.request_nominal>0?"lg:w-1/2":"lg:w-full"}`,children:[e.jsx("div",{children:"History"}),e.jsxs(ve,{defaultValue:"pengajuan",className:"w-auto",children:[e.jsxs(Ne,{className:"grid w-full grid-cols-2",children:[e.jsx(F,{value:"pengajuan",children:"Crash Kantor"}),e.jsx(F,{value:"pinjaman",children:"Crash UBM"})]}),e.jsx(z,{value:"pengajuan",children:e.jsx("div",{className:"overflow-auto shadow-sm scrollbar-thin h-max",children:e.jsx($,{data:x==null?void 0:x.history_branch})})}),e.jsx(z,{value:"pinjaman",children:e.jsx("div",{className:"overflow-auto shadow-sm scrollbar-thin h-max",children:e.jsx($,{data:x==null?void 0:x.history_lain})})})]})]})]})]})};export{ha as default};

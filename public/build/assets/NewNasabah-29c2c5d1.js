import{X as se,r as i,G as ie,d as N,j as t,a as e,F as S,f as oe}from"./app-ddd06ab0.js";import{I as c}from"./InputError-0b5d85c4.js";import{L as de}from"./Loading-a0ca0629.js";import{B as v}from"./button-79419c91.js";import"./card-46e8c7bc.js";import{T as me,a as ce,b as A,c as E}from"./tabs-35c36187.js";import{I as m}from"./input-a07130b0.js";import{L as s}from"./label-4ad91ccc.js";import{C as I}from"./index.esm-8bdf6513.js";import{u as ue,S as pe}from"./SelectComponent-700df14f.js";import M from"./RiwayatPengajuan-8247d02f.js";import{C as he}from"./Checkbox-409590e9.js";import{F as ge}from"./FormatNumbering-f3fa2cd2.js";import{u as fe}from"./useFrontEndPermission-ea989d98.js";import{N as be}from"./NoEditOverlay-191f1c25.js";import{S as ve}from"./search-7c70dcd9.js";import{X as Ne}from"./x-e1e43231.js";import"./transition-60e0c931.js";import"./index-00bc75e5.js";import"./utils-3f044a58.js";import"./index-0dba746f.js";import"./index-57bd6c01.js";import"./index-3735e9ed.js";import"./index-67ff575c.js";import"./index-0a17d4d2.js";import"./table-fbe2baa0.js";import"./index-d5bf449a.js";import"./BadgeStatus-37a35f22.js";import"./badge-0b203dc8.js";import"./react-number-format.es-fd4b1a87.js";import"./createLucideIcon-65b34bfd.js";const Ze=({onClosed:Y,generateAngsuran:T=!1,submitUrl:P,typeInput:K="number"})=>{const{printUrl:k}=se().props,{isUnit:xe,isMantri:we,isCanShowKelompok:L,isCreator:U}=fe(),[_,V]=i.useState(null);i.useEffect(()=>{V(k.url)},[k.timestamp]);const{optKelompok:F}=ue(),{data:n,setData:g,post:R,errors:u,processing:B,reset:C}=ie({isActiveMember:!1,nik:"",request_date:"",tanggal_drop:"",no_kk:"",nama:"",alamat:"",kelompok:"",request_nominal:0,angsuran:[]}),[o,b]=i.useState([]),[G,O]=i.useState(0);i.useEffect(()=>{const a=parseInt(n.request_nominal??0)*1.3,l=n.angsuran.reduce((r,d)=>{const D=parseInt(d.nominal,10);return r+(isNaN(D)?0:D)},0);O(a-l)},[n.angsuran,n.request_nominal]),i.useEffect(()=>{b([])},[n.tanggal_drop]),i.useEffect(()=>{g("angsuran",o)},[o]);const $=()=>{const a=o.length>0?N(o[o.length-1].transaction_date).add(1,"week").format("YYYY-MM-DD"):n.tanggal_drop?N(n.tanggal_drop).add(1,"week").format("YYYY-MM-DD"):"";b([...o,{id:Date.now(),transaction_date:a}])},z=a=>{b(o.filter(l=>l.id!==a))},y=(a,l,r)=>{b(o.map(d=>d.id===a?{...d,[l]:r}:d))},H=(a,l,r)=>{b(o.map(d=>d.id===r?{...d,[l]:a}:d))},[f,X]=i.useState(""),[J,x]=i.useState(!1),[j,q]=i.useState(),[p,w]=i.useState([]),[Q,W]=i.useState();i.useEffect(()=>{W(n.request_date),g(a=>({...a,tanggal_drop:N(n.request_date).add(1,"week").format("YYYY-MM-DD")}))},[n.request_date]);const Z=(a,l,r)=>{g(l,a)},h=a=>{const{name:l,value:r}=a.target;g(l,r)},ee=a=>{const{name:l,value:r}=a.target;w([]),X(r)},ae=async a=>{a.preventDefault(),C(),x(!0),q(),await oe({method:"post",url:route("transaction.nasabah_buku_transaksi"),data:{nik:f}}).then(function({data:l}){x(!1),g(r=>({...r,nik:l.return_nik,isActiveMember:!!l.data})),l.data?w(l.data):w([])}).catch(function({response:l}){q(l.data.message),x(!1)})},te=a=>{Y(),C()},ne=a=>{a.preventDefault(),R(P,{onSuccess:()=>{te()},replace:!0})},le=[{value:4e5,label:"400rb"},{value:5e5,label:"500rb"},{value:7e5,label:"700rb"},{value:8e5,label:"800rb"},{value:1e6,label:"1 jt"},{value:13e5,label:"1,3 jt"},{value:15e5,label:"1,5 jt"},{value:2e6,label:"2 jt"}],re=a=>{const l=a.target.getAttribute("data-value");g("request_nominal",l)};return t("div",{className:"flex flex-col w-full gap-3 lg:flex-row",children:[e(de,{show:J||B}),t("div",{className:"w-auto",children:[t("fieldset",{className:"min-w-[20vw] p-4 mb-3 border rounded-lg",children:[e("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"CEK NIK NASABAH"}),t("form",{className:"w-full mb-3",onSubmit:ae,children:[e(s,{optional:!0,children:"NIK"}),t("div",{className:"flex items-center gap-3",children:[e(m,{type:K,name:"nik",value:f,onChange:ee,placeholder:"Cek NIK"}),t(v,{className:"text-xs",size:"sm",children:[e(ve,{className:"w-auto h-4 mr-1"}),"Cari"]})]}),j&&e(c,{message:j,className:"mt-1"}),t("div",{className:`font-semibold mt-1 ${f.length==16?"text-green-500":"text-red-500"}`,children:[f.length," Digit"]}),e("div",{children:_&&e("a",{href:_??"#",target:"_blank",children:"Lihat Transaksi Terakhir"})})]})]}),e("div",{className:"relative",children:f&&n.nik==f&&t("fieldset",{className:"w-full p-4 border rounded-lg",children:[!U&&e(be,{value:"User Tidak Dapat Digunakan Untuk Menambah Pinjaman"}),e("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"Detail Pinjaman"}),t("form",{className:"w-full mb-3",onSubmit:ne,children:[t("div",{className:"flex flex-col gap-5 lg:flex-row",children:[t("div",{className:"flex-1",children:[t("div",{className:"flex gap-3",children:[t("div",{className:"w-full mb-3",children:[e(s,{children:"Tanggal Pengajuan"}),e(m,{type:"date",name:"request_date",required:!0,value:n.request_date,onChange:h}),e(c,{message:u.request_date})]}),t("div",{className:"w-full mb-3",children:[e(s,{children:"Tanggal Drop"}),e(m,{type:"date",name:"tanggal_drop",min:Q,required:!0,value:n.tanggal_drop,onChange:h}),e(c,{message:u.tanggal_drop})]})]}),n.request_date&&n.request_date==n.tanggal_drop?e("div",{className:"w-full mb-3 font-semibold text-red-500",children:"DROP BARU"}):e("div",{className:"w-full mb-3 font-semibold text-red-500",children:"PENGAJUAN DROP"}),t("div",{className:"w-full mb-3",children:[e(s,{optional:!0,children:"NIK"}),e(m,{type:"text",name:"nik",value:n.nik,disabled:!0,onChange:h}),e(c,{message:u.nik})]}),n.isActiveMember?t(S,{children:[t("div",{className:"w-full mb-3",children:[e(s,{children:"Nama"}),e(m,{type:"text",disabled:!0,value:p.nama??""})]}),t("div",{className:"w-full mb-3",children:[e(s,{children:"Alamat"}),e(m,{type:"text",disabled:!0,value:p.alamat??""})]})]}):t(S,{children:[t("div",{className:"w-full mb-3",children:[e(s,{optional:!0,children:"NO KK"}),e(m,{type:"text",name:"no_kk",value:n.no_kk,onChange:h}),e(c,{message:u.no_kk})]}),t("div",{className:"w-full mb-3",children:[e(s,{children:"Nama"}),e(m,{type:"text",name:"nama",value:n.nama,onChange:h,required:!0}),e(c,{message:u.nama})]}),t("div",{className:"w-full mb-3",children:[e(s,{children:"Alamat"}),e(m,{type:"text",name:"alamat",value:n.alamat,onChange:h,required:!0}),e(c,{message:u.alamat})]})]}),L&&t("div",{className:"w-full mb-3",children:[e(s,{children:"Kelompok"}),e(pe,{value:n.kelompok,options:F,name:"kelompok",nullvalue:!0,onChange:h}),e(c,{message:u.kelompok})]}),t("div",{className:"w-full mb-3",children:[e(s,{children:"Nominal Pinjaman"}),e(I,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:Z,value:n.request_nominal,placeholder:"Inputkan angka tanpa sparator"}),e(c,{message:u.request_nominal})]}),e("div",{className:"grid grid-cols-4 mb-3 gap-x-2 gap-y-1",children:le.map((a,l)=>e(v,{type:"button",size:"xs","data-value":a.value,onClick:re,children:a.label},l))})]}),o.length>0&&t("div",{className:"flex-1",children:[o.map((a,l)=>t("div",{className:"flex flex-col gap-3 mb-3 lg:flex-row",children:[t("div",{className:"w-full",children:[e(s,{children:"Tanggal Storting"}),e(m,{type:"date",name:"transaction_date",min:N(n.tanggal_drop).add(1,"week").format("YYYY-MM-DD"),required:!0,value:a.transaction_date,onChange:r=>y(a.id,r.target.name,r.target.value)})]}),t("div",{className:"w-full",children:[e(s,{children:"Nominal"}),t("div",{className:"flex items-center justify-start gap-3",children:[e("div",{className:"flex-1 min-w-32",children:e(I,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:(r,d)=>H(parseInt(r),d,a.id),value:a.nominal,placeholder:"Inputkan angka tanpa sparator"})}),t("div",{className:"flex items-center justify-start gap-1",children:[e(he,{name:"dana_titipan",id:`dana_titipan_${a.id}`,checked:a.isActiveMember,onChange:r=>y(a.id,r.target.name,r.target.checked)}),e(s,{htmlFor:`dana_titipan_${a.id}`,className:"whitespace-nowrap",nomb:!0,children:"Dana Titipan"})]}),e(v,{onClick:()=>z(a.id),type:"button",size:"iconsm",variant:"outline",children:e(Ne,{className:"w-auto h-3"})})]})]})]},a.id)),t("div",{className:"flex justify-end gap-3 font-semibold text-red-500",children:[e("div",{children:"Saldo Tersisa"}),e(ge,{value:G})]})]})]}),t("div",{className:"text-end",children:[T&&n.tanggal_drop&&e(v,{type:"button",onClick:$,className:"mr-3",variant:"outline",children:"Add Angsuran"}),e(v,{children:"Submit"})]})]})]})})]}),e("div",{className:"w-auto lg:w-full",children:t(me,{defaultValue:"pengajuan",className:"w-auto",children:[t(ce,{className:"grid w-full grid-cols-2",children:[e(A,{value:"pengajuan",children:"Crash Kantor"}),e(A,{value:"pinjaman",children:"Crash UBM"})]}),e(E,{value:"pengajuan",children:e("div",{className:"overflow-auto shadow scrollbar-thin h-max",children:e(M,{data:p==null?void 0:p.history_branch})})}),e(E,{value:"pinjaman",children:e("div",{className:"overflow-auto shadow scrollbar-thin h-max",children:e(M,{data:p==null?void 0:p.history_lain})})})]})})]})};export{Ze as default};

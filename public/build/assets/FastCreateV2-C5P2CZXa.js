import{r as l,j as e,d as c,X as he,G as ge,e as B}from"./app-DGVigBOE.js";import{A as je}from"./AuthenticatedLayout-DkCpnDCi.js";import{I as u}from"./input-hiXsNSZw.js";import{I as G}from"./InputLabel-qBCS11Wq.js";import{B as q}from"./button-rS3_Wmdu.js";import{L as be}from"./Loading-DMtMfGcu.js";import{I as h}from"./InputError-Bw8nPHcm.js";import{u as ve}from"./useFrontEndPermission-DYpEjkbr.js";import{L as o}from"./label-BShTYR7D.js";import{T as Ne,a as ke,b as T,c as E}from"./tabs-C1C762Hu.js";import{C as S}from"./index.esm-DtkwdLfj.js";import{u as we,S as _e}from"./SelectComponent-BJV9CAth.js";import{C as ye}from"./Checkbox-D4KL9AUI.js";import{P as Ce}from"./index-BKUnDlkJ.js";import{c as Se}from"./utils-CytzSlOG.js";import K from"./RiwayatPengajuan-D0cK5_qO.js";import{L as Me}from"./LinkButton-BT8h_99N.js";import{S as Ye}from"./search-DKPAWK-f.js";import"./Dropdown-DUidxbrV.js";import"./createLucideIcon-BmBwl5om.js";import"./sweetalert2.esm.all-BZfZHsFz.js";import"./index-DFy29xkF.js";import"./index-CVVN396G.js";import"./index-CJvcXCxt.js";import"./Combination-wEBvMC1Q.js";import"./index-BtqdhX95.js";import"./index-DkbJctKP.js";import"./index-DMEyqTyB.js";import"./react-icons.esm-P3OC-ayT.js";import"./SweetAlert-BC6FvQNK.js";import"./transition-CfosE7Eq.js";import"./index-BHSBDpLv.js";import"./table-DXdUzG_0.js";import"./index-eWaeB2e8.js";import"./BadgeStatus-CeZOEIeB.js";import"./badge-z741yAix.js";var Ie="Separator",U="horizontal",Ae=["horizontal","vertical"],H=l.forwardRef((g,b)=>{const{decorative:p,orientation:v=U,...m}=g,_=De(v)?v:U,R=p?{role:"none"}:{"aria-orientation":_==="vertical"?_:void 0,role:"separator"};return e.jsx(Ce.div,{"data-orientation":_,...R,...m,ref:b})});H.displayName=Ie;function De(g){return Ae.includes(g)}var X=H;const L=l.forwardRef(({className:g,orientation:b="horizontal",decorative:p=!0,...v},m)=>e.jsx(X,{ref:m,decorative:p,orientation:b,className:Se("shrink-0 bg-border",b==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",g),...v}));L.displayName=X.displayName;const ga=()=>{const g=localStorage.getItem("currentMonth")||c().format("YYYY-MM"),b=localStorage.getItem("currentKelompok")||1,[p,v]=l.useState(g),[m,_]=l.useState(b);l.useEffect(()=>{localStorage.setItem("currentMonth",p),localStorage.setItem("currentKelompok",m)},[p,m]);const{printUrl:M}=he().props,{isUnit:R,isMantri:qe,isCanShowKelompok:J,isCreator:Te}=ve(),[V,Q]=l.useState(null);l.useEffect(()=>{Q(M.url)},[M.timestamp]);const{optKelompok:W}=we(),{data:n,setData:f,post:Z,errors:j,reset:Y}=ge({isActiveMember:!1,nik:"",tanggal_drop:"",no_kk:"",nama:"",alamat:"",kelompok:m||"",request_nominal:0,angsuran:[]}),[I,ee]=l.useState(0);l.useEffect(()=>{const a=parseInt(n.request_nominal??0)*1.3,s=n.angsuran.reduce((t,r)=>{const i=parseInt(r.nominal,10);return t+(isNaN(i)?0:i)},0);ee(a-s)},[n.angsuran,n.request_nominal]);const[y,ae]=l.useState(""),[se,A]=l.useState(!1),[O,P]=l.useState(),[d,F]=l.useState([]),[N,k]=l.useState([]),[z,D]=l.useState(!1),te=a=>{const s=c(a),t=s.add(1,"week").format("YYYY-MM-DD"),r=c().format("YYYY-MM-DD");let i=c(p);const x=t<i.startOf("month").format("YYYY-MM-DD");D(x);let C=new Set;for(x&&C.add({id:1,transaction_date:t,nominal:0});i.isBefore(r);){const fe=i.format("YYYY-MM-DD");i.day()===s.day()&&i.isAfter(s)&&C.add({id:i.unix(),transaction_date:fe,nominal:0}),i=i.add(1,"day")}let xe=[...C];k(xe)},ne=(a,s,t)=>{f(s,a)},w=a=>{const{name:s,value:t}=a.target;f(s,t),s=="kelompok"&&_(t),s=="tanggal_drop"&&te(t)};l.useEffect(()=>{f("angsuran",N)},[N]);const re=a=>{const{name:s,value:t}=a.target;F([]),Y(),f("kelompok",m),k([]),D(!1),ae(t)},le=(a,s,t)=>{k(N.map(r=>r.id===a?{...r,[s]:t}:r))},ie=(a,s,t)=>{k(N.map(r=>r.id===t?{...r,[s]:a}:r))},$=l.useRef(),oe=async a=>{var t,r,i;a.preventDefault(),(t=$.current)==null||t.abort();const s=new AbortController;$.current=s,Y(),f("kelompok",m),k([]),D(!1),A(!0),P();try{const{data:x}=await B.post(route("transaction.nasabah_buku_transaksi"),{nik:y},{signal:s.signal});A(!1),f(C=>({...C,nik:x.return_nik,isActiveMember:!!x.data})),F(x.data??[])}catch(x){B.isCancel(x)?console.log("Request dibatalkan (race condition prevented)"):(P(((i=(r=x.response)==null?void 0:r.data)==null?void 0:i.message)||"Terjadi kesalahan"),A(!1))}},de=[{value:4e5,label:"400rb"},{value:5e5,label:"500rb"},{value:7e5,label:"700rb"},{value:8e5,label:"800rb"},{value:1e6,label:"1 jt"},{value:13e5,label:"1,3 jt"},{value:15e5,label:"1,5 jt"},{value:2e6,label:"2 jt"}],me=a=>{const s=a.target.getAttribute("data-value");f("request_nominal",s)},ce=a=>{const s=(n==null?void 0:n.request_nominal)*1.3-a;k(t=>t.some(r=>r.id===1)?t.map(r=>r.id===1?{...r,nominal:s}:r):[{id:1,transaction_date:c(n.tanggal_drop).add(1,"week").format("YYYY-MM-DD")},...t])},ue=a=>{Y(),f("kelompok",m)},pe=a=>{a.preventDefault(),Z(route("transaction.store_buku_transaksi_batch"),{onSuccess:()=>{ue()},replace:!0})};return e.jsxs(je,{children:[e.jsx("div",{className:"absolute z-20 right-2 bottom-2",children:e.jsx(Me,{color:"outline",href:route("transaction.fastcreate"),variant:"ghost",children:"V1"})}),e.jsx(be,{show:se}),e.jsxs("div",{className:"w-full gap-3 lg:flex",children:[e.jsxs("div",{className:`w-auto min-w-[20vw] ${n.request_nominal>0?"lg:w-1/2":"lg:w-auto"}`,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(G,{value:"Tanggal Awal",className:"mb-1"}),e.jsx(u,{type:"month",value:p,max:c().format("YYYY-MM"),onChange:a=>v(a.target.value)})]}),e.jsxs("form",{className:"mb-1",onSubmit:oe,children:[e.jsx(G,{value:"NIK",className:"mb-1"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{type:"text",onChange:re}),e.jsx(q,{variant:"destructiveoutline",children:e.jsx(Ye,{className:"w-4 h-4"})})]})]}),O&&e.jsx(h,{message:O,className:"mt-1"}),e.jsxs("div",{className:`font-semibold mb-3 ${y.length==16?"text-green-500":"text-red-500"}`,children:[y.length," Digit"]}),e.jsxs("form",{className:"relative",onSubmit:pe,children:[e.jsxs("div",{className:"flex flex-col w-full gap-3 lg:flex-row",children:[y&&n.nik==y&&e.jsxs("fieldset",{className:"flex-1 p-4 border rounded-lg",children:[e.jsx("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"Detail Pinjaman"}),e.jsx("div",{className:"w-full mb-3",children:e.jsx("div",{className:"flex flex-col gap-5 lg:flex-row",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex gap-3",children:e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Tanggal Drop"}),e.jsx(u,{type:"date",name:"tanggal_drop",required:!0,value:n.tanggal_drop,onChange:w}),e.jsx(h,{message:j.tanggal_drop}),e.jsx("div",{className:"mt-1 font-semibold text-green-500",children:c(n.tanggal_drop).format("dddd")})]})}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{optional:!0,children:"NIK"}),e.jsx(u,{type:"text",name:"nik",value:n.nik,disabled:!0,onChange:w}),e.jsx(h,{message:j.nik})]}),n.isActiveMember?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Nama"}),e.jsx(u,{type:"text",disabled:!0,value:d.nama??""})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Alamat"}),e.jsx(u,{type:"text",disabled:!0,value:d.alamat??""})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{optional:!0,children:"NO KK"}),e.jsx(u,{type:"text",name:"no_kk",value:n.no_kk,onChange:w}),e.jsx(h,{message:j.no_kk})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Nama"}),e.jsx(u,{type:"text",name:"nama",value:n.nama,onChange:w,required:!0}),e.jsx(h,{message:j.nama})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Alamat"}),e.jsx(u,{type:"text",name:"alamat",value:n.alamat,onChange:w,required:!0}),e.jsx(h,{message:j.alamat})]})]}),J&&e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Kelompok"}),e.jsx(_e,{value:n.kelompok,options:W,name:"kelompok",nullvalue:!0,onChange:w}),e.jsx(h,{message:j.kelompok})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Nominal Pinjaman"}),e.jsx(S,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:ne,value:n.request_nominal,placeholder:"Inputkan angka tanpa sparator"}),e.jsx(h,{message:j.request_nominal})]}),e.jsx("div",{className:"grid grid-cols-4 mb-3 gap-x-2 gap-y-1",children:de.map((a,s)=>e.jsx(q,{type:"button",size:"xs","data-value":a.value,onClick:me,children:a.label},s))})]})})})]}),n.request_nominal>0&&e.jsxs("fieldset",{className:"flex-1 p-4 border rounded-lg",children:[e.jsx("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"Detail Angsuran"}),c(n.tanggal_drop)&&z&&e.jsx("div",{children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(o,{children:["Saldo Akhir"," ",c(p).subtract(1,"month").format("MMMM")]}),e.jsx(S,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"nominal",defaultValue:n.request_nominal*1.3,allowDecimals:!1,prefix:"Rp. ",min:1,max:I,required:!0,onValueChange:(a,s)=>ce(a),placeholder:"Inputkan angka tanpa sparator"})]})}),e.jsx(L,{className:"my-3"}),c(n.tanggal_drop)&&N.length>0&&N.map((a,s)=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-3 lg:flex-row ",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(o,{children:"Tanggal Storting"}),e.jsx(u,{type:"date",readOnly:!0,name:"transaction_date",required:!0,value:a.transaction_date})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(o,{children:"Nominal"}),e.jsxs("div",{className:"flex items-center justify-start gap-3",children:[e.jsx("div",{className:"flex-1 min-w-32",children:e.jsx(S,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,max:I,required:!0,readOnly:z&&s==0,onValueChange:(t,r)=>ie(t,r,a.id),value:a.nominal,placeholder:"Inputkan angka tanpa sparator"})}),e.jsxs("div",{className:"flex items-center justify-start gap-1",children:[e.jsx(ye,{name:"dana_titipan",id:`dana_titipan_${a.id}`,checked:a.isActiveMember,onChange:t=>le(a.id,t.target.name,t.target.checked)}),e.jsx(o,{htmlFor:`dana_titipan_${a.id}`,className:"whitespace-nowrap",nomb:!0,children:"Dana Titipan"})]})]})]})]},a.id),e.jsx(L,{className:"my-3 bg-red-500"})]})),e.jsxs("div",{className:"mb-3",children:[e.jsx(o,{className:"mb-1",children:"Sisa Saldo"}),e.jsx(S,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,value:I,disabled:!0,placeholder:"Inputkan angka tanpa sparator"})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:V&&e.jsx("a",{href:V??"#",target:"_blank",children:"Lihat Transaksi Terakhir"})}),e.jsx("div",{children:n.request_nominal>0&&e.jsx(q,{children:"Submit"})})]})]})]}),e.jsxs("div",{className:`w-auto  ${n.request_nominal>0?"lg:w-1/2":"lg:w-full"}`,children:[e.jsx("div",{children:"Crash"}),e.jsxs(Ne,{defaultValue:"pengajuan",className:"w-auto",children:[e.jsxs(ke,{className:"grid w-full grid-cols-3",children:[e.jsx(T,{value:"pengajuan",children:"Kantor"}),e.jsx(T,{value:"pinjaman",children:"Kantor Lain (NT)"}),e.jsx(T,{value:"pinjaman2",children:"Kantor Lain (T)"})]}),e.jsx(E,{value:"pengajuan",children:e.jsx("div",{className:"overflow-auto shadow-sm scrollbar-thin h-max",children:e.jsx(K,{data:d==null?void 0:d.history_branch})})}),e.jsx(E,{value:"pinjaman",children:e.jsx("div",{className:"overflow-auto shadow-sm scrollbar-thin h-max",children:e.jsx(K,{data:d==null?void 0:d.history_macet_lain})})}),e.jsx(E,{value:"pinjaman2",children:e.jsx("div",{className:"overflow-auto shadow-sm scrollbar-thin h-max",children:e.jsx(K,{data:d==null?void 0:d.history_target})})})]})]})]})]})};export{ga as default};

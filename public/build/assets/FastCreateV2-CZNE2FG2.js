import{r as l,j as e,d as m,X as he,G as ge,e as F}from"./app-hJcCqjW3.js";import{A as je}from"./AuthenticatedLayout-CqRkYXoB.js";import{I as c}from"./input-DTZJRZ5a.js";import{I as z}from"./InputLabel-jhjU_fiF.js";import{B as q}from"./button-w0rV5GV_.js";import{L as be}from"./Loading-D350lQTx.js";import{I as h}from"./InputError-CxOHbcDS.js";import{u as ve}from"./useFrontEndPermission-CTM1adQD.js";import{L as o}from"./label-2lPo-klO.js";import{T as Ne,a as ke,b as $,c as B}from"./tabs-BrHYW8HQ.js";import{C as S}from"./index.esm-BxWG_Hjc.js";import{u as we,S as _e}from"./SelectComponent-DPbOliiM.js";import{C as ye}from"./Checkbox-DjMvCQfB.js";import{P as Ce}from"./index-YKYYjyh_.js";import{c as Se}from"./utils-CytzSlOG.js";import G from"./RiwayatPengajuan-BUpTMSc2.js";import{L as Me}from"./LinkButton-CZhASCXb.js";import{S as Ye}from"./search-aHqfTxot.js";import"./Dropdown-CjWhVSRE.js";import"./createLucideIcon-j_UEUJVl.js";import"./sweetalert2.esm.all-Bi-fklIk.js";import"./index-6W4JOOiF.js";import"./index-rcIM_YSj.js";import"./index-DIWZVBTi.js";import"./Combination-Df5DAR2C.js";import"./index-FY3p6vDS.js";import"./index-D2fmozXt.js";import"./index-Ctldr2EF.js";import"./react-icons.esm-BaCxz8el.js";import"./SweetAlert-BLHYAdeY.js";import"./transition-B3HvLuM7.js";import"./index-CBlXBiuZ.js";import"./table-D_beEVt0.js";import"./index-OIJ2qtHJ.js";import"./BadgeStatus-CCgDMpxB.js";import"./badge-DjX-fht6.js";var De="Separator",H="horizontal",Ie=["horizontal","vertical"],U=l.forwardRef((g,b)=>{const{decorative:u,orientation:v=H,...d}=g,_=Ae(v)?v:H,E=u?{role:"none"}:{"aria-orientation":_==="vertical"?_:void 0,role:"separator"};return e.jsx(Ce.div,{"data-orientation":_,...E,...d,ref:b})});U.displayName=De;function Ae(g){return Ie.includes(g)}var X=U;const T=l.forwardRef(({className:g,orientation:b="horizontal",decorative:u=!0,...v},d)=>e.jsx(X,{ref:d,decorative:u,orientation:b,className:Se("shrink-0 bg-border",b==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",g),...v}));T.displayName=X.displayName;const ga=()=>{const g=localStorage.getItem("currentMonth")||m().format("YYYY-MM"),b=localStorage.getItem("currentKelompok")||1,[u,v]=l.useState(g),[d,_]=l.useState(b);l.useEffect(()=>{localStorage.setItem("currentMonth",u),localStorage.setItem("currentKelompok",d)},[u,d]);const{printUrl:M}=he().props,{isUnit:E,isMantri:qe,isCanShowKelompok:J,isCreator:Te}=ve(),[K,Q]=l.useState(null);l.useEffect(()=>{Q(M.url)},[M.timestamp]);const{optKelompok:W}=we(),{data:n,setData:x,post:Z,errors:j,reset:Y}=ge({isActiveMember:!1,nik:"",tanggal_drop:"",no_kk:"",nama:"",alamat:"",kelompok:d||"",request_nominal:0,angsuran:[]}),[D,ee]=l.useState(0);l.useEffect(()=>{const a=parseInt(n.request_nominal??0)*1.3,s=n.angsuran.reduce((t,r)=>{const i=parseInt(r.nominal,10);return t+(isNaN(i)?0:i)},0);ee(a-s)},[n.angsuran,n.request_nominal]);const[y,ae]=l.useState(""),[se,I]=l.useState(!1),[R,L]=l.useState(),[f,V]=l.useState([]),[N,k]=l.useState([]),[O,A]=l.useState(!1),te=a=>{const s=m(a),t=s.add(1,"week").format("YYYY-MM-DD"),r=m().format("YYYY-MM-DD");let i=m(u);const p=t<i.startOf("month").format("YYYY-MM-DD");A(p);let C=new Set;for(p&&C.add({id:1,transaction_date:t,nominal:0});i.isBefore(r);){const fe=i.format("YYYY-MM-DD");i.day()===s.day()&&i.isAfter(s)&&C.add({id:i.unix(),transaction_date:fe,nominal:0}),i=i.add(1,"day")}let xe=[...C];k(xe)},ne=(a,s,t)=>{x(s,a)},w=a=>{const{name:s,value:t}=a.target;x(s,t),s=="kelompok"&&_(t),s=="tanggal_drop"&&te(t)};l.useEffect(()=>{x("angsuran",N)},[N]);const re=a=>{const{name:s,value:t}=a.target;V([]),Y(),x("kelompok",d),k([]),A(!1),ae(t)},le=(a,s,t)=>{k(N.map(r=>r.id===a?{...r,[s]:t}:r))},ie=(a,s,t)=>{k(N.map(r=>r.id===t?{...r,[s]:a}:r))},P=l.useRef(),oe=async a=>{var t,r,i;a.preventDefault(),(t=P.current)==null||t.abort();const s=new AbortController;P.current=s,Y(),x("kelompok",d),k([]),A(!1),I(!0),L();try{const{data:p}=await F.post(route("transaction.nasabah_buku_transaksi"),{nik:y},{signal:s.signal});I(!1),x(C=>({...C,nik:p.return_nik,isActiveMember:!!p.data})),V(p.data??[])}catch(p){F.isCancel(p)?console.log("Request dibatalkan (race condition prevented)"):(L(((i=(r=p.response)==null?void 0:r.data)==null?void 0:i.message)||"Terjadi kesalahan"),I(!1))}},de=[{value:4e5,label:"400rb"},{value:5e5,label:"500rb"},{value:7e5,label:"700rb"},{value:8e5,label:"800rb"},{value:1e6,label:"1 jt"},{value:13e5,label:"1,3 jt"},{value:15e5,label:"1,5 jt"},{value:2e6,label:"2 jt"}],me=a=>{const s=a.target.getAttribute("data-value");x("request_nominal",s)},ce=a=>{const s=(n==null?void 0:n.request_nominal)*1.3-a;k(t=>t.some(r=>r.id===1)?t.map(r=>r.id===1?{...r,nominal:s}:r):[{id:1,transaction_date:m(n.tanggal_drop).add(1,"week").format("YYYY-MM-DD")},...t])},ue=a=>{Y(),x("kelompok",d)},pe=a=>{a.preventDefault(),Z(route("transaction.store_buku_transaksi_batch"),{onSuccess:()=>{ue()},replace:!0})};return e.jsxs(je,{children:[e.jsx("div",{className:"absolute z-20 right-2 bottom-2",children:e.jsx(Me,{color:"outline",href:route("transaction.fastcreate"),variant:"ghost",children:"V1"})}),e.jsx(be,{show:se}),e.jsxs("div",{className:"w-full gap-3 lg:flex",children:[e.jsxs("div",{className:`w-auto min-w-[20vw] ${n.request_nominal>0?"lg:w-1/2":"lg:w-auto"}`,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(z,{value:"Tanggal Awal",className:"mb-1"}),e.jsx(c,{type:"month",value:u,max:m().format("YYYY-MM"),onChange:a=>v(a.target.value)})]}),e.jsxs("form",{className:"mb-1",onSubmit:oe,children:[e.jsx(z,{value:"NIK",className:"mb-1"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(c,{type:"text",onChange:re}),e.jsx(q,{variant:"destructiveoutline",children:e.jsx(Ye,{className:"w-4 h-4"})})]})]}),R&&e.jsx(h,{message:R,className:"mt-1"}),e.jsxs("div",{className:`font-semibold mb-3 ${y.length==16?"text-green-500":"text-red-500"}`,children:[y.length," Digit"]}),e.jsxs("form",{className:"relative",onSubmit:pe,children:[e.jsxs("div",{className:"flex flex-col w-full gap-3 lg:flex-row",children:[y&&n.nik==y&&e.jsxs("fieldset",{className:"flex-1 p-4 border rounded-lg",children:[e.jsx("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"Detail Pinjaman"}),e.jsx("div",{className:"w-full mb-3",children:e.jsx("div",{className:"flex flex-col gap-5 lg:flex-row",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex gap-3",children:e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Tanggal Drop"}),e.jsx(c,{type:"date",name:"tanggal_drop",required:!0,value:n.tanggal_drop,onChange:w}),e.jsx(h,{message:j.tanggal_drop}),e.jsx("div",{className:"mt-1 font-semibold text-green-500",children:m(n.tanggal_drop).format("dddd")})]})}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{optional:!0,children:"NIK"}),e.jsx(c,{type:"text",name:"nik",value:n.nik,disabled:!0,onChange:w}),e.jsx(h,{message:j.nik})]}),n.isActiveMember?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Nama"}),e.jsx(c,{type:"text",disabled:!0,value:f.nama??""})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Alamat"}),e.jsx(c,{type:"text",disabled:!0,value:f.alamat??""})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{optional:!0,children:"NO KK"}),e.jsx(c,{type:"text",name:"no_kk",value:n.no_kk,onChange:w}),e.jsx(h,{message:j.no_kk})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Nama"}),e.jsx(c,{type:"text",name:"nama",value:n.nama,onChange:w,required:!0}),e.jsx(h,{message:j.nama})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Alamat"}),e.jsx(c,{type:"text",name:"alamat",value:n.alamat,onChange:w,required:!0}),e.jsx(h,{message:j.alamat})]})]}),J&&e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Kelompok"}),e.jsx(_e,{value:n.kelompok,options:W,name:"kelompok",nullvalue:!0,onChange:w}),e.jsx(h,{message:j.kelompok})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(o,{children:"Nominal Pinjaman"}),e.jsx(S,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:ne,value:n.request_nominal,placeholder:"Inputkan angka tanpa sparator"}),e.jsx(h,{message:j.request_nominal})]}),e.jsx("div",{className:"grid grid-cols-4 mb-3 gap-x-2 gap-y-1",children:de.map((a,s)=>e.jsx(q,{type:"button",size:"xs","data-value":a.value,onClick:me,children:a.label},s))})]})})})]}),n.request_nominal>0&&e.jsxs("fieldset",{className:"flex-1 p-4 border rounded-lg",children:[e.jsx("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"Detail Angsuran"}),m(n.tanggal_drop)&&O&&e.jsx("div",{children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(o,{children:["Saldo Akhir"," ",m(u).subtract(1,"month").format("MMMM")]}),e.jsx(S,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"nominal",defaultValue:n.request_nominal*1.3,allowDecimals:!1,prefix:"Rp. ",min:1,max:D,required:!0,onValueChange:(a,s)=>ce(a),placeholder:"Inputkan angka tanpa sparator"})]})}),e.jsx(T,{className:"my-3"}),m(n.tanggal_drop)&&N.length>0&&N.map((a,s)=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-3 lg:flex-row ",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(o,{children:"Tanggal Storting"}),e.jsx(c,{type:"date",readOnly:!0,name:"transaction_date",required:!0,value:a.transaction_date})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(o,{children:"Nominal"}),e.jsxs("div",{className:"flex items-center justify-start gap-3",children:[e.jsx("div",{className:"flex-1 min-w-32",children:e.jsx(S,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,max:D,required:!0,readOnly:O&&s==0,onValueChange:(t,r)=>ie(t,r,a.id),value:a.nominal,placeholder:"Inputkan angka tanpa sparator"})}),e.jsxs("div",{className:"flex items-center justify-start gap-1",children:[e.jsx(ye,{name:"dana_titipan",id:`dana_titipan_${a.id}`,checked:a.isActiveMember,onChange:t=>le(a.id,t.target.name,t.target.checked)}),e.jsx(o,{htmlFor:`dana_titipan_${a.id}`,className:"whitespace-nowrap",nomb:!0,children:"Dana Titipan"})]})]})]})]},a.id),e.jsx(T,{className:"my-3 bg-red-500"})]})),e.jsxs("div",{className:"mb-3",children:[e.jsx(o,{className:"mb-1",children:"Sisa Saldo"}),e.jsx(S,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,value:D,disabled:!0,placeholder:"Inputkan angka tanpa sparator"})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:K&&e.jsx("a",{href:K??"#",target:"_blank",children:"Lihat Transaksi Terakhir"})}),e.jsx("div",{children:n.request_nominal>0&&e.jsx(q,{children:"Submit"})})]})]})]}),e.jsxs("div",{className:`w-auto  ${n.request_nominal>0?"lg:w-1/2":"lg:w-full"}`,children:[e.jsx("div",{children:"History"}),e.jsxs(Ne,{defaultValue:"pengajuan",className:"w-auto",children:[e.jsxs(ke,{className:"grid w-full grid-cols-2",children:[e.jsx($,{value:"pengajuan",children:"Crash Kantor"}),e.jsx($,{value:"pinjaman",children:"Crash Kantor Lain"})]}),e.jsx(B,{value:"pengajuan",children:e.jsx("div",{className:"overflow-auto shadow-sm scrollbar-thin h-max",children:e.jsx(G,{data:f==null?void 0:f.history_branch})})}),e.jsx(B,{value:"pinjaman",children:e.jsx("div",{className:"overflow-auto shadow-sm scrollbar-thin h-max",children:e.jsx(G,{data:f==null?void 0:f.history_lain})})})]})]})]})]})};export{ga as default};

import{r as o,a as e,d as c,X as ge,G as be,j as t,F as T,f as ve}from"./app-f22ec4d4.js";import{A as xe}from"./AuthenticatedLayout-eb33d970.js";import{I as u}from"./input-a8ee1494.js";import{I as z}from"./InputLabel-caab201a.js";import{B as E}from"./button-93fa4ceb.js";import{L as Ne}from"./Loading-bc0d1f00.js";import{I as h}from"./InputError-1d5f2b3b.js";import{u as ke}from"./useFrontEndPermission-384b0fe6.js";import{L as s}from"./label-70a262bf.js";import{T as we,a as _e,b as $,c as B}from"./tabs-f8ea8521.js";import{C as S}from"./index.esm-ea3969ea.js";import{u as ye,S as Ce}from"./SelectComponent-2a47e97e.js";import{C as Se}from"./Checkbox-0d84b6cc.js";import{P as Me}from"./index-506eafa1.js";import{c as Ye}from"./utils-3f044a58.js";import G from"./RiwayatPengajuan-822d2ad5.js";import{L as De}from"./LinkButton-a10028f8.js";import{S as Ie}from"./search-811383e1.js";import"./Navbar-019a1cf2.js";import"./createLucideIcon-259939fa.js";import"./SweetAlert-44f164d3.js";import"./index-463c697e.js";import"./index-e433ecc9.js";import"./index-62a0c5d8.js";import"./Combination-a453c124.js";import"./index-20ec7dd7.js";import"./index-3a4917e8.js";import"./react-icons.esm-b6da11e8.js";import"./transition-79940a52.js";import"./index-a3e9ae68.js";import"./table-f41ea025.js";import"./index-7c5e14b1.js";import"./FormatNumbering-9cedc195.js";import"./react-number-format.es-22455b8e.js";import"./BadgeStatus-e1e47e54.js";import"./badge-241baf22.js";var Ae="Separator",U="horizontal",je=["horizontal","vertical"],H=o.forwardRef((g,v)=>{const{decorative:p,orientation:x=U,...m}=g,_=qe(x)?x:U,V=p?{role:"none"}:{"aria-orientation":_==="vertical"?_:void 0,role:"separator"};return e(Me.div,{"data-orientation":_,...V,...m,ref:v})});H.displayName=Ae;function qe(g){return je.includes(g)}var X=H;const K=o.forwardRef(({className:g,orientation:v="horizontal",decorative:p=!0,...x},m)=>e(X,{ref:m,decorative:p,orientation:v,className:Ye("shrink-0 bg-border",v==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",g),...x}));K.displayName=X.displayName;const xa=()=>{const g=localStorage.getItem("currentMonth")||c().format("YYYY-MM"),v=localStorage.getItem("currentKelompok")||1,[p,x]=o.useState(g),[m,_]=o.useState(v);o.useEffect(()=>{localStorage.setItem("currentMonth",p),localStorage.setItem("currentKelompok",m)},[p,m]);const{printUrl:M}=ge().props,{isUnit:V,isMantri:Te,isCanShowKelompok:J,isCreator:Ee}=ke(),[L,Q]=o.useState(null);o.useEffect(()=>{Q(M.url)},[M.timestamp]);const{optKelompok:W}=ye(),{data:l,setData:y,post:Z,errors:b,processing:Ke,reset:Y}=be({isActiveMember:!1,nik:"",tanggal_drop:"",no_kk:"",nama:"",alamat:"",kelompok:m||"",request_nominal:0,angsuran:[]});console.log(l);const[D,ee]=o.useState(0);o.useEffect(()=>{const a=parseInt(l.request_nominal??0)*1.3,n=l.angsuran.reduce((r,i)=>{const d=parseInt(i.nominal,10);return r+(isNaN(d)?0:d)},0);ee(a-n)},[l.angsuran,l.request_nominal]);const[C,ae]=o.useState(""),[te,I]=o.useState(!1),[O,P]=o.useState(),[f,A]=o.useState([]),[N,k]=o.useState([]),[R,j]=o.useState(!1),ne=a=>{const n=c(a),r=n.add(1,"week").format("YYYY-MM-DD"),i=c().format("YYYY-MM-DD");let d=c(p);const F=r<d.startOf("month").format("YYYY-MM-DD");j(F);let q=new Set;for(F&&q.add({id:1,transaction_date:r,nominal:0});d.isBefore(i);){const he=d.format("YYYY-MM-DD");d.day()===n.day()&&d.isAfter(n)&&q.add({id:d.unix(),transaction_date:he,nominal:0}),d=d.add(1,"day")}let fe=[...q];k(fe)},le=(a,n,r)=>{y(n,a)},w=a=>{const{name:n,value:r}=a.target;y(n,r),n=="kelompok"&&_(r),n=="tanggal_drop"&&ne(r)};o.useEffect(()=>{y("angsuran",N)},[N]);const re=a=>{const{name:n,value:r}=a.target;A([]),Y({...l,kelompok:m}),k([]),j(!1),ae(r)},ie=(a,n,r)=>{k(N.map(i=>i.id===a?{...i,[n]:r}:i))},oe=(a,n,r)=>{k(N.map(i=>i.id===r?{...i,[n]:a}:i))},se=async a=>{a.preventDefault(),Y({...l,kelompok:m}),k([]),j(!1),I(!0),P(),await ve({method:"post",url:route("transaction.nasabah_buku_transaksi"),data:{nik:C}}).then(function({data:n}){I(!1),y(r=>({...r,nik:n.return_nik,isActiveMember:!!n.data})),n.data?A(n.data):A([])}).catch(function({response:n}){P(n.data.message),I(!1)})},de=[{value:4e5,label:"400rb"},{value:5e5,label:"500rb"},{value:7e5,label:"700rb"},{value:8e5,label:"800rb"},{value:1e6,label:"1 jt"},{value:13e5,label:"1,3 jt"},{value:15e5,label:"1,5 jt"},{value:2e6,label:"2 jt"}],me=a=>{const n=a.target.getAttribute("data-value");y("request_nominal",n)},ce=a=>{const n=(l==null?void 0:l.request_nominal)*1.3-a;k(r=>r.some(i=>i.id===1)?r.map(i=>i.id===1?{...i,nominal:n}:i):[{id:1,transaction_date:c(l.tanggal_drop).add(1,"week").format("YYYY-MM-DD")},...r])},ue=a=>{Y({...l,kelompok:m})},pe=a=>{a.preventDefault(),Z(route("transaction.store_buku_transaksi_batch"),{onSuccess:()=>{ue()},replace:!0})};return t(xe,{children:[e("div",{className:"absolute z-20 right-2 bottom-2",children:e(De,{color:"outline",href:route("transaction.fastcreate"),variant:"ghost",children:"V1"})}),e(Ne,{show:te}),t("div",{className:"w-full gap-3 lg:flex",children:[t("div",{className:`w-auto min-w-[20vw] ${l.request_nominal>0?"lg:w-1/2":"lg:w-auto"}`,children:[t("div",{className:"mb-3",children:[e(z,{value:"Tanggal Awal",className:"mb-1"}),e(u,{type:"month",value:p,max:c().format("YYYY-MM"),onChange:a=>x(a.target.value)})]}),t("form",{className:"mb-1",onSubmit:se,children:[e(z,{value:"NIK",className:"mb-1"}),t("div",{className:"flex gap-3",children:[e(u,{type:"text",onChange:re}),e(E,{variant:"destructiveoutline",children:e(Ie,{className:"w-4 h-4"})})]})]}),O&&e(h,{message:O,className:"mt-1"}),t("div",{className:`font-semibold mb-3 ${C.length==16?"text-green-500":"text-red-500"}`,children:[C.length," Digit"]}),t("form",{className:"relative",onSubmit:pe,children:[t("div",{className:"flex flex-col w-full gap-3 lg:flex-row",children:[C&&l.nik==C&&t("fieldset",{className:"flex-1 p-4 border rounded-lg",children:[e("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"Detail Pinjaman"}),e("div",{className:"w-full mb-3",children:e("div",{className:"flex flex-col gap-5 lg:flex-row",children:t("div",{className:"flex-1",children:[e("div",{className:"flex gap-3",children:t("div",{className:"w-full mb-3",children:[e(s,{children:"Tanggal Drop"}),e(u,{type:"date",name:"tanggal_drop",required:!0,value:l.tanggal_drop,onChange:w}),e(h,{message:b.tanggal_drop}),e("div",{className:"mt-1 font-semibold text-green-500",children:c(l.tanggal_drop).format("dddd")})]})}),t("div",{className:"w-full mb-3",children:[e(s,{optional:!0,children:"NIK"}),e(u,{type:"text",name:"nik",value:l.nik,disabled:!0,onChange:w}),e(h,{message:b.nik})]}),l.isActiveMember?t(T,{children:[t("div",{className:"w-full mb-3",children:[e(s,{children:"Nama"}),e(u,{type:"text",disabled:!0,value:f.nama??""})]}),t("div",{className:"w-full mb-3",children:[e(s,{children:"Alamat"}),e(u,{type:"text",disabled:!0,value:f.alamat??""})]})]}):t(T,{children:[t("div",{className:"w-full mb-3",children:[e(s,{optional:!0,children:"NO KK"}),e(u,{type:"text",name:"no_kk",value:l.no_kk,onChange:w}),e(h,{message:b.no_kk})]}),t("div",{className:"w-full mb-3",children:[e(s,{children:"Nama"}),e(u,{type:"text",name:"nama",value:l.nama,onChange:w,required:!0}),e(h,{message:b.nama})]}),t("div",{className:"w-full mb-3",children:[e(s,{children:"Alamat"}),e(u,{type:"text",name:"alamat",value:l.alamat,onChange:w,required:!0}),e(h,{message:b.alamat})]})]}),J&&t("div",{className:"w-full mb-3",children:[e(s,{children:"Kelompok"}),e(Ce,{value:l.kelompok,options:W,name:"kelompok",nullvalue:!0,onChange:w}),e(h,{message:b.kelompok})]}),t("div",{className:"w-full mb-3",children:[e(s,{children:"Nominal Pinjaman"}),e(S,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:le,value:l.request_nominal,placeholder:"Inputkan angka tanpa sparator"}),e(h,{message:b.request_nominal})]}),e("div",{className:"grid grid-cols-4 mb-3 gap-x-2 gap-y-1",children:de.map((a,n)=>e(E,{type:"button",size:"xs","data-value":a.value,onClick:me,children:a.label},n))})]})})})]}),l.request_nominal>0&&t("fieldset",{className:"flex-1 p-4 border rounded-lg",children:[e("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"Detail Angsuran"}),c(l.tanggal_drop)&&R&&e("div",{children:t("div",{className:"mb-3",children:[t(s,{children:["Saldo Akhir"," ",c(p).subtract(1,"month").format("MMMM")]}),e(S,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"nominal",defaultValue:l.request_nominal*1.3,allowDecimals:!1,prefix:"Rp. ",min:1,max:D,required:!0,onValueChange:(a,n)=>ce(a),placeholder:"Inputkan angka tanpa sparator"})]})}),e(K,{className:"my-3"}),c(l.tanggal_drop)&&N.length>0&&N.map((a,n)=>t(T,{children:[t("div",{className:"flex flex-col gap-3 mb-3 lg:flex-row ",children:[t("div",{className:"w-full",children:[e(s,{children:"Tanggal Storting"}),e(u,{type:"date",readOnly:!0,name:"transaction_date",required:!0,value:a.transaction_date})]}),t("div",{className:"w-full",children:[e(s,{children:"Nominal"}),t("div",{className:"flex items-center justify-start gap-3",children:[e("div",{className:"flex-1 min-w-32",children:e(S,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,max:D,required:!0,readOnly:R&&n==0,onValueChange:(r,i)=>oe(r,i,a.id),value:a.nominal,placeholder:"Inputkan angka tanpa sparator"})}),t("div",{className:"flex items-center justify-start gap-1",children:[e(Se,{name:"dana_titipan",id:`dana_titipan_${a.id}`,checked:a.isActiveMember,onChange:r=>ie(a.id,r.target.name,r.target.checked)}),e(s,{htmlFor:`dana_titipan_${a.id}`,className:"whitespace-nowrap",nomb:!0,children:"Dana Titipan"})]})]})]})]},a.id),e(K,{className:"my-3 bg-red-500"})]})),t("div",{className:"mb-3",children:[e(s,{className:"mb-1",children:"Sisa Saldo"}),e(S,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,value:D,disabled:!0,placeholder:"Inputkan angka tanpa sparator"})]})]})]}),t("div",{className:"flex justify-between",children:[e("div",{children:L&&e("a",{href:L??"#",target:"_blank",children:"Lihat Transaksi Terakhir"})}),e("div",{children:l.request_nominal>0&&e(E,{children:"Submit"})})]})]})]}),t("div",{className:`w-auto  ${l.request_nominal>0?"lg:w-1/2":"lg:w-full"}`,children:[e("div",{children:"History"}),t(we,{defaultValue:"pengajuan",className:"w-auto",children:[t(_e,{className:"grid w-full grid-cols-2",children:[e($,{value:"pengajuan",children:"Crash Kantor"}),e($,{value:"pinjaman",children:"Crash UBM"})]}),e(B,{value:"pengajuan",children:e("div",{className:"overflow-auto shadow scrollbar-thin h-max",children:e(G,{data:f==null?void 0:f.history_branch})})}),e(B,{value:"pinjaman",children:e("div",{className:"overflow-auto shadow scrollbar-thin h-max",children:e(G,{data:f==null?void 0:f.history_lain})})})]})]})]})]})};export{xa as default};

import{r as d,G as U,X as A,e as $,j as e,d as c}from"./app-AELOPLCZ.js";import{D as O,a as W,b as X,c as z}from"./dialog-DPStc_mG.js";import{T as J,a as K,b as B,c as C,d as Q,e as D}from"./table-0q2qAPmO.js";import{I as y}from"./InputLabel-BeBSEjpn.js";import"./TextInput-DKblEGn7.js";import{C as I}from"./index.esm-F5lwKMEI.js";import{B as Z}from"./button-Ba-S8mLe.js";import{L as ee}from"./Loading-C3rkLawJ.js";import ne from"./ButtonAngsuran-D9q2Gd_c.js";import"./index-CjRjMPa4.js";import"./index-C67KgSUI.js";import"./index-BxS7OyuJ.js";import"./Combination-B8PH48jG.js";import"./index-Dw3zMUp6.js";import"./index-C9ENTI8Y.js";import"./react-icons.esm-BYptaF-P.js";import"./utils-CytzSlOG.js";import"./transition-bQQhNkNj.js";const Ye=({show:m=m,onClosed:T,triggeredId:u})=>{var j;const[o,p]=d.useState(null),[f,_]=d.useState(0),{data:s,setData:i,post:k,processing:E,reset:R}=U({saldobefore:0,month:"",id:"",instalment:[]}),h=()=>{T(),R(),p(null),g(null)},F=(j=A().props.server_filter)==null?void 0:j.month,L=A().props.server_filter.hari;d.useEffect(()=>{m&&u&&$.post(route("pinjaman.get_synch_angsuran",u),{month:F,day:L}).then(n=>{var a;p((a=n.data)==null?void 0:a.data),i(t=>{var l,r,v,Y,N,S,w,M;return{...t,saldobefore:(r=(l=n.data)==null?void 0:l.data)==null?void 0:r.saldoSebelumnya,id:(Y=(v=n.data)==null?void 0:v.data)==null?void 0:Y.id,month:(S=(N=n.data)==null?void 0:N.data)==null?void 0:S.month,instalment:(M=(w=n.data)==null?void 0:w.data)==null?void 0:M.angsuran}})})},[m,u]);const b=(n,a,t=null)=>{if(t!==null){const l=[...s.instalment];l[t]={...l[t],nominal:n},i("instalment",l)}else i(a,n)};d.useEffect(()=>{var n;if(o!=null&&o.instalments){const a=s==null?void 0:s.saldobefore,t=(n=s==null?void 0:s.instalment)==null?void 0:n.reduce((l,r)=>l+(parseFloat(r.nominal)||0),0);_(a-t)}},[o,s]);const[G,ae]=d.useState([1e4,3e4,5e4,52e3,6e4,65e3,1e5,104e3,13e4,195e3,26e4,39e4]),[x,g]=d.useState(null),P=n=>{n.preventDefault(),k(route("pinjaman.synch_angsuran",u),{preserveScroll:!0,onSuccess:()=>{h()}})},V=(n,a)=>{const t=[...s.instalment];t[a]={...t[a],nominal:n},i("instalment",t)},q=(n,a)=>{var r;const t=((r=s.instalment[a])==null?void 0:r.nominal)??0,l=[...s.instalment];l[a]={...l[a],nominal:parseFloat(t)+(n.deltaY<0?-1e3:1e3)},i("instalment",l)},H=n=>{const a=parseFloat(s.saldobefore)??0;i("saldobefore",a+(n.deltaY<0?-1e3:1e3))};return e.jsxs(O,{open:m,onOpenChange:n=>n?"":h(),children:[e.jsx(ee,{show:E}),e.jsxs(W,{className:"p-1 lg:p-6 lg:min-w-[50vw] min-w-[80vw] max-w-[90vw] w-auto",children:[e.jsx(X,{children:e.jsx(z,{children:"Angsuran"})}),e.jsx("div",{className:"h-[80vh] overflow-auto",children:o?e.jsxs("div",{className:"lg:grid-cols-2 grid w-full gap-3",children:[e.jsxs("form",{onSubmit:P,children:[e.jsx("p",{children:"Perbaiki Angsuran"}),e.jsxs("div",{className:"mb-1",children:["ANGSURAN PER"," ",e.jsx("span",{className:"text-green-500 font-semibold",children:c(o==null?void 0:o.month).format("MMMM YYYY")})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(y,{value:`Saldo  ${c(o==null?void 0:o.month).format("MMMM YYYY")}`}),e.jsx(I,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"saldobefore",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onWheel:H,onValueChange:(n,a)=>b(n,a),value:s.saldobefore,placeholder:"Inputkan angka tanpa sparator"})]}),(s==null?void 0:s.instalment)&&(s==null?void 0:s.instalment.map((n,a)=>{var t;return e.jsxs("div",{className:`mb-1 relative ${x==a&&"bg-green-50"}`,children:[e.jsx(y,{value:`Angsuran ${c(n==null?void 0:n.transaction_date).format("DD-MM-YYYY")}`}),e.jsx(I,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 mb-2",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onWheel:l=>q(l,a),onFocus:l=>g(a),onValueChange:(l,r)=>b(l,r,a),value:(t=s.instalment[a])==null?void 0:t.nominal,placeholder:"Inputkan angka tanpa sparator"}),x==a&&e.jsx(ne,{nominalPembayaran:G,pelunasan:f,onClickButton:V,index:a})]},a)})),e.jsx("div",{children:e.jsx(Z,{variant:"green",type:"submit",children:"Submit"})}),e.jsx("div",{className:"text-green-500 font-semibold text-lg",children:f.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Detail Angsuran"}),e.jsx("div",{className:"mb-1",children:o&&e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(B,{children:[e.jsx(C,{children:"Date"}),e.jsx(C,{children:"Nominal"})]})}),e.jsx(Q,{children:o&&(o==null?void 0:o.instalments.map((n,a)=>{var t;return e.jsxs(B,{children:[e.jsx(D,{children:c(n==null?void 0:n.transaction_date).format("DD/MM/YYYY")}),e.jsx(D,{children:(t=n.nominal)==null?void 0:t.toLocaleString()})]},a)}))})]})})]})]}):e.jsx("div",{children:"MENUNGGU DATA"})})]})]})};export{Ye as default};

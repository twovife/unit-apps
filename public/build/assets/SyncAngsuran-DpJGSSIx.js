import{r as d,G as U,X as A,e as $,j as e,d as u}from"./app-Bhivlch7.js";import{D as O,a as W,b as X,c as z}from"./dialog-Cb4zMS0d.js";import{T as J,a as K,b as B,c as C,d as Q,e as D}from"./table-C1HsK9wX.js";import{I as y}from"./InputLabel-D5qPCyQL.js";import"./TextInput-CBBDYOh-.js";import{C as I}from"./index.esm-BWpq93dO.js";import{B as Z}from"./button-WrdTxjeE.js";import{L as ee}from"./Loading-t8FMcHgb.js";import ne from"./ButtonAngsuran-BkbaLIcn.js";import"./index-B3V2_4vW.js";import"./index-RiEVygcu.js";import"./index-BpvjGo4Q.js";import"./Combination-DDbaWZJo.js";import"./index-CPeVGlOF.js";import"./index-BXTG1-HC.js";import"./react-icons.esm-DdkpgTZ2.js";import"./utils-CytzSlOG.js";import"./transition-BaHuss9e.js";const Ye=({show:m=m,onClosed:T,triggeredId:c})=>{var j;const[l,p]=d.useState(null),[f,_]=d.useState(0),{data:s,setData:i,post:k,processing:E,reset:R}=U({saldobefore:0,month:"",id:"",instalment:[]}),h=()=>{T(),R(),p(null),g(null)},F=(j=A().props.server_filter)==null?void 0:j.month,L=A().props.server_filter.hari;d.useEffect(()=>{m&&c&&$.post(route("pinjaman.get_synch_angsuran",c),{month:F,day:L}).then(n=>{var a;p((a=n.data)==null?void 0:a.data),i(o=>{var t,r,v,Y,N,S,w,M;return{...o,saldobefore:(r=(t=n.data)==null?void 0:t.data)==null?void 0:r.saldoSebelumnya,id:(Y=(v=n.data)==null?void 0:v.data)==null?void 0:Y.id,month:(S=(N=n.data)==null?void 0:N.data)==null?void 0:S.month,instalment:(M=(w=n.data)==null?void 0:w.data)==null?void 0:M.angsuran}})})},[m,c]);const b=(n,a,o=null)=>{if(o!==null){const t=[...s.instalment];t[o]={...t[o],nominal:n},i("instalment",t)}else i(a,n)};d.useEffect(()=>{var n;if(l!=null&&l.instalments){const a=s==null?void 0:s.saldobefore,o=(n=s==null?void 0:s.instalment)==null?void 0:n.reduce((t,r)=>t+(parseFloat(r.nominal)||0),0);_(a-o)}},[l,s]);const[G,ae]=d.useState([1e4,3e4,5e4,52e3,6e4,65e3,1e5,104e3,13e4,195e3,26e4,39e4]),[x,g]=d.useState(null),P=n=>{n.preventDefault(),k(route("pinjaman.synch_angsuran",c),{preserveScroll:!0,onSuccess:()=>{h()}})},V=(n,a)=>{const o=[...s.instalment];o[a]={...o[a],nominal:n},i("instalment",o)},q=(n,a)=>{var r;console.log(n.deltaY);const o=((r=s.instalment[a])==null?void 0:r.nominal)??0,t=[...s.instalment];t[a]={...t[a],nominal:parseFloat(o)+(n.deltaY<0?-1e3:1e3)},i("instalment",t)},H=n=>{const a=parseFloat(s.saldobefore)??0;i("saldobefore",a+(n.deltaY<0?-1e3:1e3))};return e.jsxs(O,{open:m,onOpenChange:n=>n?"":h(),children:[e.jsx(ee,{show:E}),e.jsxs(W,{className:"p-1 lg:p-6 min-w-[50vw] max-w-[90vw] w-auto",children:[e.jsx(X,{children:e.jsx(z,{children:"Angsuran"})}),e.jsx("div",{className:"h-[80vh]",children:l?e.jsxs("div",{className:"lg:grid-cols-2 grid w-full gap-3",children:[e.jsxs("form",{onSubmit:P,children:[e.jsx("p",{children:"Perbaiki Angsuran"}),e.jsxs("div",{className:"mb-1",children:["ANGSURAN PER"," ",e.jsx("span",{className:"text-green-500 font-semibold",children:u(l==null?void 0:l.month).format("MMMM YYYY")})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(y,{value:`Saldo  ${u(l==null?void 0:l.month).format("MMMM YYYY")}`}),e.jsx(I,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"saldobefore",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onWheel:H,onValueChange:(n,a)=>b(n,a),value:s.saldobefore,placeholder:"Inputkan angka tanpa sparator"})]}),(s==null?void 0:s.instalment)&&(s==null?void 0:s.instalment.map((n,a)=>{var o;return e.jsxs("div",{className:`mb-1 relative ${x==a&&"bg-green-50"}`,children:[e.jsx(y,{value:`Angsuran ${u(n==null?void 0:n.transaction_date).format("DD-MM-YYYY")}`}),e.jsx(I,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 mb-2",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onWheel:t=>q(t,a),onFocus:t=>g(a),onValueChange:(t,r)=>b(t,r,a),value:(o=s.instalment[a])==null?void 0:o.nominal,placeholder:"Inputkan angka tanpa sparator"}),x==a&&e.jsx(ne,{nominalPembayaran:G,pelunasan:f,onClickButton:V,index:a})]})})),e.jsx("div",{children:e.jsx(Z,{variant:"green",type:"submit",children:"Submit"})}),e.jsx("div",{className:"text-green-500 font-semibold text-lg",children:f.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Detail Angsuran"}),e.jsx("div",{className:"mb-1",children:l&&e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(B,{children:[e.jsx(C,{children:"Date"}),e.jsx(C,{children:"Nominal"})]})}),e.jsx(Q,{children:l&&(l==null?void 0:l.instalments.map(n=>{var a;return e.jsxs(B,{children:[e.jsx(D,{children:u(n==null?void 0:n.transaction_date).format("DD/MM/YYYY")}),e.jsx(D,{children:(a=n.nominal)==null?void 0:a.toLocaleString()})]})}))})]})})]})]}):e.jsx("div",{children:"MENUNGGU DATA"})})]})]})};export{Ye as default};

import{q as ce,r as s,W as me,c as k,j as a,a as e,F as A,l as ue}from"./app-9f0c20ba.js";import{I as m}from"./InputError-a7129d09.js";import{L as pe}from"./Loading-4684ca26.js";import{B as h}from"./button-4d2c16c2.js";import{C as E,a as I,b as T,c as Y,d as M}from"./card-12a3d3a1.js";import{T as he,a as ge,b as P,c as R}from"./tabs-04a9a8b8.js";import{I as c}from"./input-8fa00c8e.js";import{L as i}from"./label-9a31c979.js";import{C as K}from"./index.esm-fdc0f4ba.js";import{u as fe,S as be}from"./SelectComponent-d8400a6f.js";import L from"./RiwayatPengajuan-4a555352.js";import{C as ve}from"./Checkbox-0e3f17dc.js";import{F as Ne}from"./FormatNumbering-e421a0ec.js";import{u as ke}from"./useFrontEndPermission-24b0ff10.js";import{N as we}from"./NoEditOverlay-734d27a1.js";import{S as xe,X as Ce}from"./x-693481f3.js";import"./transition-9b556442.js";import"./utils-aa679991.js";import"./index-1dedb023.js";import"./index-598efb9f.js";import"./index-ba8f6734.js";import"./index-c62517c3.js";import"./index-ed8129d8.js";import"./table-10c9d57c.js";import"./index-b1d98478.js";import"./BadgeStatus-582477e4.js";import"./badge-b629424d.js";import"./react-number-format.es-e08b783c.js";import"./createLucideIcon-baeb41fa.js";const aa=({onClosed:U,generateAngsuran:z=!1,submitUrl:F,typeInput:V="number"})=>{const{printUrl:C}=ce().props,{isUnit:_e,isMantri:ye,isCanShowKelompok:O,isCreator:B}=ke(),[_,G]=s.useState(null);s.useEffect(()=>{G(C.url)},[C.timestamp]);const{optKelompok:H}=fe(),{data:n,setData:f,post:$,errors:u,processing:J,reset:y}=me({isActiveMember:!1,nik:"",request_date:"",tanggal_drop:"",no_kk:"",nama:"",alamat:"",kelompok:"",request_nominal:0,angsuran:[]});console.log(n);const[o,v]=s.useState([]),[W,X]=s.useState(0);s.useEffect(()=>{const t=parseInt(n.request_nominal??0)*1.3,l=n.angsuran.reduce((r,d)=>{const S=parseInt(d.nominal,10);return r+(isNaN(S)?0:S)},0);X(t-l)},[n.angsuran,n.request_nominal]),s.useEffect(()=>{v([])},[n.tanggal_drop]),s.useEffect(()=>{f("angsuran",o)},[o]);const Q=()=>{const t=o.length>0?k(o[o.length-1].transaction_date).add(1,"week").format("YYYY-MM-DD"):n.tanggal_drop?k(n.tanggal_drop).add(1,"week").format("YYYY-MM-DD"):"";v([...o,{id:Date.now(),transaction_date:t}])},Z=t=>{v(o.filter(l=>l.id!==t))},q=(t,l,r)=>{v(o.map(d=>d.id===t?{...d,[l]:r}:d))},ee=(t,l,r)=>{v(o.map(d=>d.id===r?{...d,[l]:t}:d))},[b,ae]=s.useState(""),[te,w]=s.useState(!1),[D,j]=s.useState(),[p,x]=s.useState([]),[ne,le]=s.useState();s.useEffect(()=>{le(n.request_date),f(t=>({...t,tanggal_drop:k(n.request_date).add(1,"week").format("YYYY-MM-DD")}))},[n.request_date]);const re=(t,l,r)=>{f(l,t)},g=t=>{const{name:l,value:r}=t.target;f(l,r)},ie=t=>{const{name:l,value:r}=t.target;x([]),ae(r)},se=async t=>{t.preventDefault(),y(),w(!0),j(),await ue({method:"post",url:route("transaction.nasabah_buku_transaksi"),data:{nik:b}}).then(function({data:l}){w(!1),f(r=>({...r,nik:l.return_nik,isActiveMember:!!l.data})),l.data?x(l.data):x([])}).catch(function({response:l}){j(l.data.message),w(!1)})},oe=t=>{U(),y()},de=t=>{t.preventDefault(),$(F,{onSuccess:()=>{oe()},replace:!0})},N=t=>{const l=t.target.getAttribute("data-value");f("request_nominal",l)};return a("div",{className:"flex flex-col w-full gap-3 lg:flex-row",children:[e(pe,{show:te||J}),a("div",{className:"w-auto",children:[a("fieldset",{className:"min-w-[20vw] p-4 mb-3 border rounded-lg",children:[e("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"CEK NIK NASABAH"}),a("form",{className:"w-full mb-3",onSubmit:se,children:[e(i,{optional:!0,children:"NIK"}),a("div",{className:"flex items-center gap-3",children:[e(c,{type:V,name:"nik",value:b,onChange:ie,placeholder:"Cek NIK"}),a(h,{className:"text-xs",size:"sm",children:[e(xe,{className:"w-auto h-4 mr-1"}),"Cari"]})]}),D&&e(m,{message:D,className:"mt-1"}),a("div",{className:`font-semibold mt-1 ${b.length==16?"text-green-500":"text-red-500"}`,children:[b.length," Digit"]}),e("div",{children:_&&e("a",{href:_??"#",target:"_blank",children:"Lihat Transaksi Terakhir"})})]})]}),e("div",{className:"relative",children:b&&n.nik==b&&a("fieldset",{className:"w-full p-4 border rounded-lg",children:[!B&&e(we,{value:"User Tidak Dapat Digunakan Untuk Menambah Pinjaman"}),e("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"Detail Pinjaman"}),a("form",{className:"w-full mb-3",onSubmit:de,children:[a("div",{className:"flex flex-col gap-5 lg:flex-row",children:[a("div",{className:"flex-1",children:[a("div",{className:"flex gap-3",children:[a("div",{className:"w-full mb-3",children:[e(i,{children:"Tanggal Pengajuan"}),e(c,{type:"date",name:"request_date",required:!0,value:n.request_date,onChange:g}),e(m,{message:u.request_date})]}),a("div",{className:"w-full mb-3",children:[e(i,{children:"Tanggal Drop"}),e(c,{type:"date",name:"tanggal_drop",min:ne,required:!0,value:n.tanggal_drop,onChange:g}),e(m,{message:u.tanggal_drop})]})]}),n.request_date&&n.request_date==n.tanggal_drop?e("div",{className:"w-full mb-3 font-semibold text-red-500",children:"DROP BARU"}):e("div",{className:"w-full mb-3 font-semibold text-red-500",children:"PENGAJUAN DROP"}),a("div",{className:"w-full mb-3",children:[e(i,{optional:!0,children:"NIK"}),e(c,{type:"text",name:"nik",value:n.nik,disabled:!0,onChange:g}),e(m,{message:u.nik})]}),n.isActiveMember?a(A,{children:[a("div",{className:"w-full mb-3",children:[e(i,{children:"Nama"}),e(c,{type:"text",disabled:!0,value:p.nama??""})]}),a("div",{className:"w-full mb-3",children:[e(i,{children:"Alamat"}),e(c,{type:"text",disabled:!0,value:p.alamat??""})]})]}):a(A,{children:[a("div",{className:"w-full mb-3",children:[e(i,{optional:!0,children:"NO KK"}),e(c,{type:"text",name:"no_kk",value:n.no_kk,onChange:g}),e(m,{message:u.no_kk})]}),a("div",{className:"w-full mb-3",children:[e(i,{children:"Nama"}),e(c,{type:"text",name:"nama",value:n.nama,onChange:g,required:!0}),e(m,{message:u.nama})]}),a("div",{className:"w-full mb-3",children:[e(i,{children:"Alamat"}),e(c,{type:"text",name:"alamat",value:n.alamat,onChange:g,required:!0}),e(m,{message:u.alamat})]})]}),O&&a("div",{className:"w-full mb-3",children:[e(i,{children:"Kelompok"}),e(be,{value:n.kelompok,options:H,name:"kelompok",nullvalue:!0,onChange:g}),e(m,{message:u.kelompok})]}),a("div",{className:"w-full mb-3",children:[e(i,{children:"Nominal Pinjaman"}),e(K,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:re,value:n.request_nominal,placeholder:"Inputkan angka tanpa sparator"}),e(m,{message:u.request_nominal})]}),a("div",{className:"flex flex-wrap w-full gap-2 mb-3",children:[e(h,{type:"button",variant:"outline",size:"xs",onClick:N,"data-value":"500000",children:"500.000"}),e(h,{type:"button",variant:"outline",size:"xs",onClick:N,"data-value":"700000",children:"700.000"}),e(h,{type:"button",variant:"outline",size:"xs",onClick:N,"data-value":"1000000",children:"1.000.000"}),e(h,{type:"button",variant:"destructive",size:"xs",onClick:N,"data-value":"0",children:"reset"})]})]}),o.length>0&&a("div",{className:"flex-1",children:[o.map((t,l)=>a("div",{className:"flex flex-col gap-3 mb-3 lg:flex-row",children:[a("div",{className:"w-full",children:[e(i,{children:"Tanggal Storting"}),e(c,{type:"date",name:"transaction_date",min:k(n.tanggal_drop).add(1,"week").format("YYYY-MM-DD"),required:!0,value:t.transaction_date,onChange:r=>q(t.id,r.target.name,r.target.value)})]}),a("div",{className:"w-full",children:[e(i,{children:"Nominal"}),a("div",{className:"flex items-center justify-start gap-3",children:[e("div",{className:"flex-1 min-w-32",children:e(K,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:(r,d)=>ee(parseInt(r),d,t.id),value:t.nominal,placeholder:"Inputkan angka tanpa sparator"})}),a("div",{className:"flex items-center justify-start gap-1",children:[e(ve,{name:"dana_titipan",id:`dana_titipan_${t.id}`,checked:t.isActiveMember,onChange:r=>q(t.id,r.target.name,r.target.checked)}),e(i,{htmlFor:`dana_titipan_${t.id}`,className:"whitespace-nowrap",nomb:!0,children:"Dana Titipan"})]}),e(h,{onClick:()=>Z(t.id),type:"button",size:"iconsm",variant:"outline",children:e(Ce,{className:"w-auto h-3"})})]})]})]},t.id)),a("div",{className:"flex justify-end gap-3 font-semibold text-red-500",children:[e("div",{children:"Saldo Tersisa"}),e(Ne,{value:W})]})]})]}),a("div",{className:"text-end",children:[z&&n.tanggal_drop&&e(h,{type:"button",onClick:Q,className:"mr-3",variant:"outline",children:"Add Angsuran"}),e(h,{children:"Submit"})]})]})]})})]}),e("div",{className:"w-auto lg:w-full",children:a(he,{defaultValue:"pengajuan",className:"w-auto",children:[a(ge,{className:"grid w-full grid-cols-2",children:[e(P,{value:"pengajuan",children:"Riwayat Pinjaman"}),e(P,{value:"pinjaman",children:"Riwayat Lain"})]}),e(R,{value:"pengajuan",children:a(E,{children:[a(I,{children:[e(T,{children:"Riwayat Unit"}),e(Y,{children:"Riwayat Pengajuan Nasabah sesuai dengan nik di satu unit"})]}),e(M,{className:"space-y-2",children:e("div",{className:"h-[50vh] border rounded-lg overflow-auto scrollbar-thumb-gray-300 scrollbar-track-transparent scrollbar-thin",children:e(L,{data:p==null?void 0:p.history_branch})})})]})}),e(R,{value:"pinjaman",children:a(E,{children:[a(I,{children:[e(T,{children:"Riwayat Lain"}),e(Y,{children:"Riwayat Pengajuan Nasabah sesuai dengan nik di unit selain unit ini"})]}),e(M,{className:"space-y-2",children:e("div",{className:"h-[50vh] border rounded-lg overflow-auto scrollbar-thumb-gray-300 scrollbar-track-transparent scrollbar-thin",children:e(L,{data:p==null?void 0:p.history_lain})})})]})})]})})]})};export{aa as default};

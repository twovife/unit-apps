import{X as te,r,G as ne,d as j,j as e,e as le}from"./app-CqcR4o-I.js";import{I as m}from"./InputError-C1zG0ETX.js";import{L as re}from"./Loading-Gaw3zRP9.js";import{B as f}from"./button-C3Yf6trC.js";import"./card-DHWPA8Sm.js";import{T as ie,a as oe,b as D,c as S}from"./tabs-D1jhZbUW.js";import{I as d}from"./input-CkHiLFyH.js";import{L as l}from"./label-BIauyaOn.js";import{C as A}from"./index.esm-CXWYZSXO.js";import{u as de,S as me}from"./SelectComponent-DXm_MVyv.js";import ce from"./RiwayatPengajuan-D6tMXsGz.js";import{C as ue}from"./Checkbox-BuJfmuZ4.js";import{F as xe}from"./FormatNumbering-CbzwBviE.js";import{u as pe}from"./useFrontEndPermission-CNw0hFKA.js";import{N as he}from"./NoEditOverlay-Rde-VDlX.js";import ge from"./RiwayatPengajuanLain-DTMNgzxS.js";import{S as fe}from"./search-DEgVt8Lb.js";import{X as je}from"./x-MZkDcn-S.js";import"./index-BVWlmGlD.js";import"./transition-PZ5ySWFT.js";import"./index-C4zUF3DV.js";import"./utils-CytzSlOG.js";import"./index-lp8A8aSq.js";import"./index-Bo6Wcmo4.js";import"./index-CsAFLrT9.js";import"./index-B1bOsdhx.js";import"./index-Dif-k1Vk.js";import"./table-CNqJIfia.js";import"./index-Be9rwAc1.js";import"./react-number-format.es-CP72o4yg.js";import"./createLucideIcon-BhTe5XdU.js";const We=({onClosed:E,generateAngsuran:I=!1,submitUrl:M,typeInput:Y="number"})=>{const{printUrl:N}=te().props,{isUnit:be,isMantri:ve,isCanShowKelompok:T,isCreator:P}=pe(),[w,K]=r.useState(null);r.useEffect(()=>{K(N.url)},[N.timestamp]);const{optKelompok:L}=de(),{data:s,setData:p,post:R,errors:c,processing:U,reset:k}=ne({isActiveMember:!1,nik:"",request_date:"",tanggal_drop:"",no_kk:"",nama:"",alamat:"",kelompok:"",request_nominal:0,angsuran:[]}),[i,g]=r.useState([]),[V,F]=r.useState(0);r.useEffect(()=>{const a=parseInt(s.request_nominal??0)*1.3,t=s.angsuran.reduce((n,o)=>{const q=parseInt(o.nominal,10);return n+(isNaN(q)?0:q)},0);F(a-t)},[s.angsuran,s.request_nominal]),r.useEffect(()=>{g([])},[s.tanggal_drop]),r.useEffect(()=>{p("angsuran",i)},[i]);const B=()=>{const a=i.length>0?j(i[i.length-1].transaction_date).add(1,"week").format("YYYY-MM-DD"):s.tanggal_drop?j(s.tanggal_drop).add(1,"week").format("YYYY-MM-DD"):"";g([...i,{id:Date.now(),transaction_date:a}])},G=a=>{g(i.filter(t=>t.id!==a))},_=(a,t,n)=>{g(i.map(o=>o.id===a?{...o,[t]:n}:o))},O=(a,t,n)=>{g(i.map(o=>o.id===n?{...o,[t]:a}:o))},[h,$]=r.useState(""),[z,b]=r.useState(!1),[C,y]=r.useState(),[u,v]=r.useState([]),[H,X]=r.useState();r.useEffect(()=>{X(s.request_date),p(a=>({...a,tanggal_drop:j(s.request_date).add(1,"week").format("YYYY-MM-DD")}))},[s.request_date]);const J=(a,t,n)=>{p(t,a)},x=a=>{const{name:t,value:n}=a.target;p(t,n)},Q=a=>{const{name:t,value:n}=a.target;v([]),$(n)},W=async a=>{a.preventDefault(),k(),b(!0),y(),await le({method:"post",url:route("transaction.nasabah_buku_transaksi"),data:{nik:h}}).then(function({data:t}){b(!1),p(n=>({...n,nik:t.return_nik,isActiveMember:!!t.data})),t.data?(console.log(t.data),v(t.data)):v([])}).catch(function({response:t}){y(t.data.message),b(!1)})},Z=a=>{E(),k()},ee=a=>{a.preventDefault(),R(M,{onSuccess:()=>{Z()},replace:!0})},ae=[{value:3e5,label:"300rb"},{value:4e5,label:"400rb"},{value:5e5,label:"500rb"},{value:7e5,label:"700rb"},{value:8e5,label:"800rb"},{value:1e6,label:"1 jt"},{value:13e5,label:"1,3 jt"},{value:15e5,label:"1,5 jt"},{value:2e6,label:"2 jt"}],se=a=>{const t=a.target.getAttribute("data-value");p("request_nominal",t)};return e.jsxs("div",{className:"flex flex-col w-full gap-3 lg:flex-row",children:[e.jsx(re,{show:z||U}),e.jsxs("div",{className:"w-auto",children:[e.jsxs("fieldset",{className:"min-w-[20vw] p-4 mb-3 border rounded-lg",children:[e.jsx("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"CEK NIK NASABAH"}),e.jsxs("form",{className:"w-full mb-3",onSubmit:W,children:[e.jsx(l,{optional:!0,children:"NIK"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{type:Y,name:"nik",value:h,onChange:Q,placeholder:"Cek NIK"}),e.jsxs(f,{className:"text-xs",size:"sm",children:[e.jsx(fe,{className:"w-auto h-4 mr-1"}),"Cari"]})]}),C&&e.jsx(m,{message:C,className:"mt-1"}),e.jsxs("div",{className:`font-semibold mt-1 ${h.length==16?"text-green-500":"text-red-500"}`,children:[h.length," Digit"]}),e.jsx("div",{children:w&&e.jsx("a",{href:w??"#",target:"_blank",children:"Lihat Transaksi Terakhir"})})]})]}),e.jsx("div",{className:"relative",children:h&&s.nik==h&&e.jsxs("fieldset",{className:"w-full p-4 border rounded-lg",children:[!P&&e.jsx(he,{value:"User Tidak Dapat Digunakan Untuk Menambah Pinjaman"}),e.jsx("legend",{className:"px-1 -ml-1 text-sm font-medium",children:"Detail Pinjaman"}),e.jsxs("form",{className:"w-full mb-3",onSubmit:ee,children:[e.jsxs("div",{className:"flex flex-col gap-5 lg:flex-row",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(l,{children:"Tanggal Pengajuan"}),e.jsx(d,{type:"date",name:"request_date",required:!0,value:s.request_date,onChange:x}),e.jsx(m,{message:c.request_date})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(l,{children:"Tanggal Drop"}),e.jsx(d,{type:"date",name:"tanggal_drop",min:H,required:!0,value:s.tanggal_drop,onChange:x}),e.jsx(m,{message:c.tanggal_drop})]})]}),s.request_date&&s.request_date==s.tanggal_drop?e.jsx("div",{className:"w-full mb-3 font-semibold text-red-500",children:"DROP BARU"}):e.jsx("div",{className:"w-full mb-3 font-semibold text-red-500",children:"PENGAJUAN DROP"}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(l,{optional:!0,children:"NIK"}),e.jsx(d,{type:"text",name:"nik",value:s.nik,disabled:!0,onChange:x}),e.jsx(m,{message:c.nik})]}),s.isActiveMember?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(l,{children:"Nama"}),e.jsx(d,{type:"text",disabled:!0,value:u.nama??""})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(l,{children:"Alamat"}),e.jsx(d,{type:"text",disabled:!0,value:u.alamat??""})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(l,{optional:!0,children:"NO KK"}),e.jsx(d,{type:"text",name:"no_kk",value:s.no_kk,onChange:x}),e.jsx(m,{message:c.no_kk})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(l,{children:"Nama"}),e.jsx(d,{type:"text",name:"nama",value:s.nama,onChange:x,required:!0}),e.jsx(m,{message:c.nama})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(l,{children:"Alamat"}),e.jsx(d,{type:"text",name:"alamat",value:s.alamat,onChange:x,required:!0}),e.jsx(m,{message:c.alamat})]})]}),T&&e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(l,{children:"Kelompok"}),e.jsx(me,{value:s.kelompok,options:L,name:"kelompok",nullvalue:!0,onChange:x}),e.jsx(m,{message:c.kelompok})]}),e.jsxs("div",{className:"w-full mb-3",children:[e.jsx(l,{children:"Nominal Pinjaman"}),e.jsx(A,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"request_nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:J,value:s.request_nominal,placeholder:"Inputkan angka tanpa sparator"}),e.jsx(m,{message:c.request_nominal})]}),e.jsx("div",{className:"grid grid-cols-4 mb-3 gap-x-2 gap-y-1",children:ae.map((a,t)=>e.jsx(f,{type:"button",size:"xs","data-value":a.value,onClick:se,children:a.label},t))})]}),i.length>0&&e.jsxs("div",{className:"flex-1",children:[i.map((a,t)=>e.jsxs("div",{className:"flex flex-col gap-3 mb-3 lg:flex-row",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(l,{children:"Tanggal Storting"}),e.jsx(d,{type:"date",name:"transaction_date",min:j(s.tanggal_drop).add(1,"week").format("YYYY-MM-DD"),required:!0,value:a.transaction_date,onChange:n=>_(a.id,n.target.name,n.target.value)})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(l,{children:"Nominal"}),e.jsxs("div",{className:"flex items-center justify-start gap-3",children:[e.jsx("div",{className:"flex-1 min-w-32",children:e.jsx(A,{className:"flex w-full px-3 py-1 text-sm transition-colors bg-transparent border rounded-md shadow-xs h-9 border-input file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",name:"nominal",defaultValue:0,allowDecimals:!1,prefix:"Rp. ",min:1,required:!0,onValueChange:(n,o)=>O(parseInt(n),o,a.id),value:a.nominal,placeholder:"Inputkan angka tanpa sparator"})}),e.jsxs("div",{className:"flex items-center justify-start gap-1",children:[e.jsx(ue,{name:"dana_titipan",id:`dana_titipan_${a.id}`,checked:a.isActiveMember,onChange:n=>_(a.id,n.target.name,n.target.checked)}),e.jsx(l,{htmlFor:`dana_titipan_${a.id}`,className:"whitespace-nowrap",nomb:!0,children:"Dana Titipan"})]}),e.jsx(f,{onClick:()=>G(a.id),type:"button",size:"iconsm",variant:"outline",children:e.jsx(je,{className:"w-auto h-3"})})]})]})]},a.id)),e.jsxs("div",{className:"flex justify-end gap-3 font-semibold text-red-500",children:[e.jsx("div",{children:"Saldo Tersisa"}),e.jsx(xe,{value:V})]})]})]}),e.jsxs("div",{className:"text-end",children:[I&&s.tanggal_drop&&e.jsx(f,{type:"button",onClick:B,className:"mr-3",variant:"outline",children:"Add Angsuran"}),e.jsx(f,{children:"Submit"})]})]})]})})]}),e.jsx("div",{className:"w-auto lg:w-full",children:e.jsxs(ie,{defaultValue:"pengajuan",className:"w-auto",children:[e.jsxs(oe,{className:"grid w-full grid-cols-2",children:[e.jsx(D,{value:"pengajuan",children:"Crash Kantor"}),e.jsx(D,{value:"pinjaman",children:"Crash UBM"})]}),e.jsx(S,{value:"pengajuan",children:e.jsx("div",{className:"overflow-auto shadow-sm scrollbar-thin h-max",children:e.jsx(ce,{data:u==null?void 0:u.history_branch})})}),e.jsx(S,{value:"pinjaman",children:e.jsx("div",{className:"overflow-auto shadow-sm scrollbar-thin h-max",children:e.jsx(ge,{data:u==null?void 0:u.history_lain})})})]})})]})};export{We as default};
